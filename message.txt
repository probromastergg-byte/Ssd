local Players = game:GetService("Players")

local _g = (getgenv and getgenv()) or nil
local _loaderToken = _g and _g.VexusLoaderToken
--[[ 
if not _loaderToken then
	pcall(function()
		local lp = Players.LocalPlayer
		if lp then
			lp:Kick("KASP SECURITY")
		end
	end)
	return
end
]]
pcall(function()
	_g.VexusLoaderToken = nil
end)

local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(repo .. "addons/SaveManager.lua"))()
local Options = Library.Options
local Toggles = Library.Toggles
Library.ForceCheckbox = false
Library.ShowToggleFrameInKeybinds = true
local Sport_cloth_PriceTable = {
    ["Красная Футболка 'Demix'"] = 1200,
    ["Белая Футболка 'Puma'"] = 1500,
    ["Чёрные Джоггеры 'Puma'"] = 1500,
    ["Серый Жилет 'Moncler'"] = 3500,
    ["Спортивные Штаны 'Polo'"] = 1300,
    ["Чёрная Спортивная Джинсовка 'Puma'"] = 2300,
    ["Чёрная Футболка 'Puma'"] = 1450,
    ["Серые Штаны 'Nike'"] = 1300,
    ["Тренажёрная Куртка 'Nike'"] = 5850,
    ["Чёрная Куртка 'Rebook'"] = 3500,
    ["Серая Худи 'Rebook'"] = 2500,
    ["Чёрные Спортивные Штаны 'Puma'"] = 2400
}
local Adidas_cloth_PriceTable = {
    ["Серая Футболка Logo 'Adidas'"] = 2328,
    ["Лаймовая Кофта White 'Adidas'"] = 8427,
    ["Красная Спортивка White 'Adidas'"] = 8503,
    ["Белая Футболка Pinstripe 'Adidas'"] = 2076,
    ["Синяя Футболка Logo 'Adidas'"] = 2850,
    ["Тёмно Синяя Кофта 'Adidas'"] = 2527,
    ["Белая Футболка Tricolor Germany 'Adidas'"] = 10198,
    ["Черное Худи 'Adidas'"] = 5653,
    ["Белое Поло 'Adidas'"] = 3848,
    ["Серая Спортивка White 'Adidas'"] = 23845,
    ["Белый Свитер Black 'Adidas'"] = 4275,
    ["Черная Футболка Red Logo 'Adidas'"] = 3943,
    ["Баскетбольная Футболка 'Adidas'"] = 3658,
    ["Зеленое Поло 'Adidas'"] = 94050,
    ["Розовая Кофта White 'Adidas'"] = 4142,
    ["Спортивка American 'Adidas'"] = 8845,
    ["Бордовая Кофта White 'Adidas'"] = 6498,
    ["Черная Футболка Orange 'Adidas'"] = 998,
    ["Черная Футболка С Синими Полосками 'Adidas'"] = 2993,
    ["Черная Спортивка Gold 'Adidas'"] = 5653,
    ["Джерзи Real Madrid 'Adidas'"] = 5368,
    ["Черные Порванные Штаны 'Adidas'"] = 3705,
    ["Оранжевые Спортивные Штаны 'Adidas'"] = 3800,
    ["Черные Треники 'Adidas'"] = 3895,
    ["Черные Штаны Для Бега 'Adidas'"] = 3895,
    ["Серые Джинсы 'Adidas'"] = 3943,
    ["Черные Футбольные Штаны 'Adidas'"] = 4133,
    ["Чёрные Спортивные Штаны 'Adidas'"] = 2451,
    ["Джерзи NY Knicks #23 'Adidas'"] = 8550,
    ["Синий Спортивный Костюм White 'Adidas'"] = 3515,
    ["Серые Треники 'Adidas'"] = 5035,
    ["Чёрные Спортивки 'Adidas'"] = 5225,
    ["Тёмно Серые Шорты 'Adidas'"] = 2565,
    ["Черная Ветровка Green Wave 'Adidas'"] = 3230,
    ["Синяя Футболка 'Adidas X Gucci'"] = 24700,
    ["Розовые Спортивные Штаны 'Adidas'"] = 5130,
    ["Серые Спортивные Брюки"] = 2133
}
local Bape_cloth_PriceTable = {
    ["Фиолетовый Зип-Худи 'BAPE'"] = 44444,
    ["Белая Футболка 'BAPE STA'"] = 9000,
    ["Красная Футболка 'BAPE'"] = 9000,
    ["Серые Джинсы 'BAPE STA'"] = 35378,
    ["Чёрные Джинсы 'BAPE STA'"] = 33778,
    ["Тёмные Джинсы 'BAPE STA'"] = 33778,
    ["Бежевый Зип-Худи 'BAPE'"] = 55110,
    ["Рюкзак 'BAPE'"] = 92000,
    ["Черный Рюкзак 'BAPE'"] = 390000,
    ["Черная Зип-Худи Baby-Milo"] = 50000,
    ["Черный Зип-Худи 'BAPE'"] = 55110,
    ["Серый Зип-Худи 'BAPE'"] = 55110,
    ["Джинсы 'BAPE'"] = 33778,
    ["Черный Зип-Худи 'BAPE x Baby Milo'"] = 62222,
    ["Черный Свитер 'BAPE STA'"] = 43000,
    ["Синий Зип-Худи 'BAPE STA'"] = 32000,
    ["Серый Зип-Худи 'BAPE STA'"] = 21000,
    ["Бежевая Зип-Худи 'BAPE STA'"] = 55110,
    ["Оранжевая Зип-Худи 'BAPE STA'"] = 71110,
    ["Жёлтая Футболка 'BAPE'"] = 11555,
    ["Черная Футболка 'BAPE x Baby Milo'"] = 6666,
    ["Серый Свитшот 'BAPE STA'"] = 20800,
    ["Зелёная Зипка 'Bape'"] = 99000,
    ["Лонгслив 'BAPE'"] = 24000
}
local ChromeHearts_cloth_PriceTable = {
    ["Джинсы 'Levis X Chrome Hearts'"] = 840000,
    ["Бежевая Кофта Cemetery Cross Tire Tracks 'Chrome Hearts'"] = 130000,
    ["Коричневый Худи Horse Shoe 'Chrome Hearts'"] = 140000,
    ["Чёрная Худи Multi Color Cross 'Chrome Hearts'"] = 177778,
    ["Голубые Джинсы 'Chrome Hearts'"] = 284444,
    ["Джинсы Multiple Crosses 'Chrome Hearts'"] = 88889,
    ["Джинсы CROSS PINK 'Chrome Hearts'"] = 268000,
    ["Джинсы CROSS RED 'Chrome Hearts'"] = 432000,
    ["Джинсы CROSS GREEN 'Chrome Hearts'"] = 272000,
    ["Кожаные Джинсы 'Matty Boy X Chrome Hearts'"] = 664000,
    ["Чёрная Куртка 'Matty Boy X Chrome Hearts'"] = 700000,
    ["Цитрусовый Лонгслив Record 'Matty Boy X Chrome Hearts'"] = 105000,
    ["Красный Лонгслив Chomper 'Matty Boy X Chrome Hearts'"] = 65000,
    ["Коричневая Худи Horse Shoe 'Chrome Hearts'"] = 172444,
    ["Чёрная Худи 'Chrome Hearts'"] = 172444,
    ["Зеленая зипка 'Chrome Hearts'"] = 99000,
    ["Серые Джинсы 'Chrome Hearts'"] = 115555,
    ["Светлые Джинсы 'Chrome Hearts'"] = 100000,
    ["Чёрно-Красная Худи 'Chrome Hearts'"] = 440000,
    ["Чёрно-Зеленая Худи 'Chrome Hearts'"] = 130000,
    ["Коричневая Худи Horse Shoe 'Chrome Hearts'"] = 140000,
    ["Худи 'Chrome Hearts'"] = 170000,
    ["Лаймовые Джинсы NYFW 'Chrome Hearts'"] = 2880000,
    ["Джинсы 'Chrome Hearts x Carhartt'"] = 2133333,
    ["Кофта 'Matty Boy X Chrome Hearts'"] = 110000,
    ["Чёрная Худи Las Vegas 'Chrome Hearts'"] = 84000,
    ["Чёрная Худи 'Matty Boy X Chrome Hearts'"] = 213600,
    ["Чёрный Свитшот Chomper 'Matty Boy X Chrome Hearts'"] = 104889,
    ["Кожанная Куртка CROSS RED 'Chrome Hearts'"] = 391110,
    ["Белая Кофта PLUS CROSS 'Chrome Hearts'"] = 92444,
    ["Серый Лонгслив Vanity 'Matty Boy X Chrome Hearts'"] = 80000,
    ["Белый Лонгслив Las Vegas 'Chrome Hearts'"] = 74666,
    ["Чёрная Футболка Hong Kong 'Chrome Hearts'"] = 62222,
    ["Чёрная Футболка America 'Chrome Hearts'"] = 40889,
    ["Чёрная Футболка 'Rolling Stones' X 'Chrome Hearts'"] = 133333,
    ["Белая Футболка 'Rolling Stones' X 'Chrome Hearts'"] = 115555,
    ["Винтажная Рубашка Horse Shoe 'Chrome Hearts'"] = 1600000,
    ["Чёрный Свитшот Horse Shoe 'Chrome Hearts'"] = 132000
}
local Vetements_cloth_PriceTable = {
    ["Синяя Куртка Global Mind 'Vetements'"] = 60070,
    ["Серое Пальто Wmns 'Vetements'"] = 148320,
    ["Бордовый Бомбер Burgundy racer 'Vetements'"] = 273122,
    ["Чёрный Бомбер Racing 'Vetements X Alpha Industries'"] = 491619,
    ["Серый Бомбер Racing 'Vetements X Alpha Industries'"] = 491619,
    ["Фиолетовая Куртка Total Darkness 'Vetements'"] = 300432,
    ["Деним Джинсовка 'Vetements'"] = 28552,
    ["Серое Худи Hug Me 'Vetements'"] = 109249,
    ["Серое Худи 4 everyone 'Vetements'"] = 15017,
    ["Чёрное Худи Vital Existence 'Vetements'"] = 57845,
    ["Худи Antwerpen 'Champion × Vetements'"] = 40046,
    ["Чёрное Худи Pirate Bay 'Vetements'"] = 77868,
    ["Белая Худи Interpol 'Vetements'"] = 46721,
    ["Худи Reconstructed 'Vetements'"] = 42271,
    ["Зеленая Зипка 'Vetements'"] = 110128,
    ["Худи 'i did nothing i just have lucky Vetements'"] = 81205,
    ["Худи 'Marilyn Manson Vetements'"] = 111240,
    ["Худи 'Made in Europe'"] = 127926,
    ["Худи 'Vital Existance Vetements'"] = 56732,
    ["Синий Лонгслив Made in Europe 'Vetements'"] = 111240,
    ["Лонгслив Heartbreaker 'Vetements'"] = 55716,
    ["Чёрный Лонгслив hi-speed 'Vetements'"] = 54624,
    ["Лонгслив i did nothing i just got lucky 'Vetements'"] = 52654,
    ["Чёрный Лонгслив Rated Restricted 'Vetements'"] = 27810,
    ["Белая Футболка Euphoria 'Vetements'"] = 41513,
    ["Серая Футболка i dont do drama 'Vetements'"] = 20579,
    ["Серая Футболка Double Layer Maria 'Vetements'"] = 109029,
    ["Чёрная Футболка The Devil Wears Vetements 'Vetements'"] = 34484,
    ["Белая Футболка No social media 'Vetements'"] = 24719,
    ["Футболка 'Money Vetements'"] = 29496,
    ["Чёрная Футболка 'Car Hotline Vetements'"] = 32228,
    ["Футболка 'stop being rich Vetements'"] = 65439,
    ["Чёрная Футболка Anarchy 'Vetements'"] = 37144,
    ["Белая Футболка Embroidered 'Vetements'"] = 18540,
    ["Оранжевая Футболка hi-speed 'Vetements'"] = 54624,
    ["Чёрная Футболка Jerk 'Vetements'"] = 27810,
    ["Красная Худи MTB RED  'Vetements'"] = 278100,
    ["Джинсы Made on Earth 'Vetements'"] = 34484,
    ["Джинсы Winter 2018 Logo Embroidered 'Vetements'"] = 73418,
    ["Красные Штаны Fan Deconstructed 'Vetements'"] = 155736,
    ["Джинсы Gothic Logo 'Vetements'"] = 88992,
    ["Штаны Police Green 'Vetements'"] = 81205,
    ["Штаны Camouflage 'Vetements'"] = 57845,
    ["Розовые Штаны Checkered 'Vetements'"] = 155736
}
local Zara_cloth_PriceTable = {
    ["Синий Пиджак 'ZARA'"] = 10500,                       -- zara15 Resell[1]
    ["Белая Джинсовка Graffiti 'ZARA'"] = 10500,          -- zara1 Resell[1]
    ["Синяя Куртка 'ZARA'"] = 3675,                       -- zara10 Resell[1]
    ["Чёрная Джинсовая Куртка 'ZARA'"] = 3675,            -- zara11 Resell[1]
    ["Чёрная Джинсовка 'ZARA'"] = 3675,                   -- zara6 Resell[1]
    ["Серая Zip-Hoodie 'ZARA'"] = 3150,                   -- zara2 Resell[1]
    ["Синий Свитер 'ZARA'"] = 3150,                       -- zara9 Resell[1]
    ["Чёрная Рубашка 'ZARA'"] = 13125,                    -- zara3 Resell[1]
    ["Розовая Деловая Рубашка 'ZARA'"] = 7350,            -- zara13 Resell[1]
    ["Белая Футболка 'ZARA'"] = 1470,                     -- zara4 Resell[1]
    ["Чёрная Футболка 'ZARA'"] = 1470,                    -- zara5 Resell[1]
    ["Чёрная Футболка С Белыми Рукавами 'ZARA'"] = 1470,  -- zara7 Resell[1]s
    ["Розовая Футболка 'ZARA'"] = 1470,                   -- zara12 Resell[1]
    ["Жёлтая Футболка 'ZARA'"] = 1470,                    -- zara14 Resell[1]
    ["Чёрный Лонгслив 'ZARA'"] = 2100,                    -- zara8 Resell[1]
    ["Чёрные Порванные Джинсы 'ZARA'"] = 2450,            -- zarapants4 Resell[1]
    ["Порванные Джинсы 'ZARA'"] = 2450,                   -- zarapants5 Resell[1]
    ["Белые Рваные Джинсы 'ZARA'"] = 2450,                -- zarapants2 Resell[1]
    ["Серые Штаны 'ZARA'"] = 2450,                        -- zarapants3 Resell[1]
    ["Штаны Side Cheker 'ZARA'"] = 2450,                  -- zarapants1 Resell[1]
    ["Белая Майка 'Zara'"] = 1575,
    ["Жёлтая Майка 'Zara'"] = 1575,
    ["Зелёная Зипка 'ZARA'"] = 103950
}
local StoneIsland_cloth_PriceTable = {
    ["Болотная Куртка 'Stone Island'"] = 71200,                       -- StoneShirt2 Resell[2] * 0.8
    ["Чёрная Куртка 'Stone Island'"] = 71200,                         -- StoneShirt4 Resell[2] * 0.8
    ["Свитшот С Жилетом 'Carhartt X Stone Island'"] = 33600,          -- StoneShirt6 Resell[2] * 0.8
    ["Чёрная Джинсовка 'Stone Island'"] = 33600,                      -- StoneShirt1 Resell[2] * 0.8
    ["Красный Свитшот 'Stone Island'"] = 23200,                       -- StoneShirt8 Resell[2] * 0.8
    ["Чёрные Джоггеры 'Stone Island'"] = 26400,                       -- StonePants1 Resell[2] * 0.8
    ["Синие Джинсы 'Stone Island'"] = 26400,                          -- StonePants3 Resell[2] * 0.8
    ["Тёмные Штаны 'Stone Island'"] = 26400,                          -- StonePants4 Resell[2] * 0.8
    ["Серые Джинсы 'Stone Island'"] = 26400,                          -- StonePants2 Resell[2] * 0.8
    ["Рубашка С Жилетом 'Stone Island'"] = 34400,                     -- StoneShirt5 Resell[2] * 0.8
    ["Серый Свитшот 'Stone Island'"] = 23200,                         -- StoneShirt7 Resell[2] * 0.8
    ["Фиолетовый Свитер 'Stone Island'"] = 29600,                     -- StoneShirt10 Resell[2] * 0.8
    ["Болотный Свитшот 'Stone Island'"] = 23200,                      -- StoneShirt9 Resell[2] * 0.8
    ["Бежевая Рубашка 'Stone Island'"] = 16800,                       -- StoneShirt3 Resell[2] * 0.8
    ["Зелёная Зипка 'Stone Island'"] = 99000,
    ["Зелёный Свитшот 'Stone Island'"] = 22000,
    ["Рубашка 'Stone Island'"] = 12000
}
local Balenciaga_cloth_PriceTable = {
    ["Красная Куртка 'Balenciaga'"] = 175000, 
    ["Брюки 'Balenciaga'"] = 37333,
    ["Чёрный Свитер 'Balenciaga'"] = 20000,
    ["Красный Свитер 'Balenciaga'"] = 20000,
    ["Зелёный Свитер 'Balenciaga'"] = 20000,
    ["Потрёпанные Штаны 'Balenciaga'"] = 27200,
    ["Тёмные Джинсы 'Balenciaga'"] = 33778,
    ["Джинсы Double Waits 'Balenciaga'"] = 44444,
    ["Спортивные Джоггеры 'Balenciaga'"] = 27200,
    ["Зелёная Зипка 'Balenciaga'"] = 99000,
    ["Голубая Джинсовка 'Balenciaga'"] = 130000,
    ["Бежевый Свитшот 'Balenciaga'"] = 22000, 
    ["Белый Свитшот 'Balenciaga'"] = 28000, 
    ["Белая Футболка 'Balenciaga'"] = 22000,
    ["Чёрная Футболка 'Balenciaga'"] = 22000,
    ["Салатовый Свитер 'Balenciaga'"] = 23000,
    ["Джоггеры 'Balenciaga'"] = 27200,
    ["Худи 'Balenciaga'"] = 30000,
    ["Худи Бежевая 'Balenciaga'"] = 85000,
    ["Джинсы Raver 'Balenciaga'"] = 1200000,
    ["Джинсы Slashed 'Balenciaga'"] = 240000,
    ["Спортивные Кожанные Штаны 3B 'Balenciaga'"] = 1200000
}
local LouisVuitton_cloth_PriceTable = {
    ["Коричневая Деловая Рубашка 'Louis Vuitton'"] = 231200,                -- lvshirt1 Resell[2] * 0.8
    ["Чёрно Белая рубашка Monogram 'Louis Vuitton'"] = 124000,              -- lvshirt10 Resell[2] * 0.8
    ["Рубашка 'Louis Vuitton'"] = 54000,                                    -- ручная, отдельной записи в дампе нет
    ["Болотный Деловой Костюм 'Louis Vuitton'"] = 260800,                   -- lvshirt4 Resell[2] * 0.8
    ["Синий Свитер Intarsia Logo 'Louis Vuitton'"] = 108000,               -- lvshirt11 Resell[2] * 0.8
    ["Чёрный Лонгслив Print Logo 'Louis Vuitton'"] = 26400,                -- lvshirt12 Resell[2] * 0.8
    ["Синяя Футболка CITIES HALF 'Louis Vuitton'"] = 48000,                 -- lvshirt2 Resell[2] * 0.8
    ["Фиолетовая Худи 'Louis Vuitton'"] = 15000,                            -- нет точного аналога в дампе, оставляем ручную
    ["Белая Худи 'Louis Vuitton'"] = 18800,                                 -- lvshirt5 Resell[2] * 0.8
    ["Фиолетовая Кофта CASPER 'Mega Yacht X Louis Vuitton'"] = 17778,      -- lvshirt3 Resell[2] * 0.8
    ["Красный Свитер Новый Год 2024 'Louis Vuitton'"] = 20000,             -- LouisVuittonBlixx Resell[2] * 0.8
    ["Чёрная Куртка Пуффер Checks 'Louis Vuitton'"] = 1000000,              -- lvshirt7 Resell[2] * 0.8
    ["Белая Джинсовка Varsity 'Louis Vuitton'"] = 544000,                   -- lvshirt8 Resell[2] * 0.8
    ["Коричневый Бомбер 'Louis Vuitton'"] = 232000,                         -- lvshirt9 Resell[2] * 0.8
    ["Синяя Джинсовая Куртка 'Supreme X Louis Vuitton'"] = 1320000,        -- lvshirt6 Resell[2] * 0.8
    ["Тёмные Деловые Брюки 'Louis Vuitton'"] = 120000,                      -- lvpants1 Resell[2] * 0.8
    ["Рюкзак 'Louis Vuitton'"] = 228000,                                    -- LoiusBackpack Resell[2] * 0.8
    ["Чёрный Шарф 'Louis Vuitton'"] = 47110,                                -- lvclassic1 Resell[2] * 0.8
    ["Синий Шарф 'Louis Vuitton'"] = 47110,                                 -- lvclassic2 Resell[2] * 0.8
    ["Синяя Худи 'Louis Vuitton'"] = 120000                                 -- ручная, оставляем как есть
}
local Gucci_cloth_PriceTable = {
    ["Розовая Рубашка Love Letter 'Gucci'"] = 42666,                -- guccishirt11 Resell[2] * 0.8
    ["Бежевый Свитер Lamb 'Gucci'"] = 73777,                       -- guccishirt6 Resell[2] * 0.8
    ["Красная Худи Snake Print 'Gucci'"] = 64000,                  -- guccishirt10 Resell[2] * 0.8
    ["Синий Спортивный Костюм 'Gucci'"] = 124000,                  -- guccishirt2 Resell[2] * 0.8 (строго по Context)
    ["Куртка Tiger Print 'Gucci'"] = 100000,                       -- guccishirt5 Resell[2] * 0.8
    ["Монограммная Футболка Ghost 'Gucci'"] = 25600,              -- guccishirt1 Resell[2] * 0.8
    ["Синяя Джинсовка 'Gucci'"] = 116000,                          -- guccishirt4 Resell[2] * 0.8
    ["Чёрное Худи Future 'Gucci'"] = 40888,                        -- guccishirt15 Resell[2] * 0.8
    ["Чёрное Худи Logo 'Gucci'"] = 104000,                         -- guccishirt8 Resell[2] * 0.8
    ["Синяя Кожанная Куртка 'Gucci'"] = 136000,                    -- guccishirt9 Resell[2] * 0.8
    ["Чёрные Джинсы Snake 'Gucci'"] = 76800,                       -- guccipants1 Resell[2] * 0.8
    ["Фиолетовая Джинсовка Varsity 'Off-White x Gucci'"] = 340000, -- guccishirt13 Resell[2] * 0.8
    ["Белая Футболка Logo 'Gucci'"] = 24000,                       -- guccishirt3 Resell[2] * 0.8
    ["Зелёная Зипка 'Gucci'"] = 990000,                            -- нет Price, оставляем
    ["Серые Штаны Snake 'Gucci'"] = 92000,                         -- guccipants2 Resell[2] * 0.8
    ["Серые Штаны 'Gucci'"] = 76000,                              -- guccipants3 Resell[2] * 0.8
    ["Чёрные Брюки 'Gucci'"] = 109600,                            -- guccipants4 Resell[2] * 0.8
    ["Джинсовая Куртка NY 'Gucci'"] = 340000,                      -- guccishirt12 Resell[2] * 0.8
    ["Синий Деловой Костюм 'Gucci'"] = 280000,                     -- guccishirt7 Resell[2] * 0.8
    ["Синяя Рубашка 'Gucci'"] = 100000,                            -- guccishirt14 Resell[2] * 0.8
    ["Синяя Футболка 'Gucci'"] = 1150000                           -- нет явного Price, оставляем
}
local Supreme_cloth_PriceTable = {
    ["Красный Свитшот 'Bevel'"] = 23500,
    ["Коричнево-Болотный Свитшот Split 'Supreme'"] = 29000,
    ["Свитшот NY 'Supreme'"] = 11000,
    ["Свитшот Hate 'Supreme'"] = 33000,
    ["Серое Худи BOX LOGO 'Supreme'"] = 41000,
    ["Зелёное Худи Arabic 'Supreme'"] = 26500,
    ["Принт Худи B&S 'Supreme'"] = 28000,
    ["Берюзовая Худи Motion Logo 'Supreme'"] = 36444,                      -- SupremeShirt13 Resell[2] * 0.8
    ["Принт Худи 8-Ball 'Supreme'"] = 27555,                               -- SupremeShirt17 Resell[2] * 0.8
    ["Принт Свитшот Scatter Text 'Supreme'"] = 12444,                      -- SupremeShirt18 Resell[2] * 0.8
    ["Салатовый Свитер Jacquard Logo 'Supreme'"] = 6000,
    ["Коричневый Монограммный Свитер 'Supreme'"] = 533333,                 -- SupremeShirt1 Resell[2] * 0.8
    ["Чёрный Свитер 'Supreme x CDG'"] = 64000,                             -- SupremeShirt24 Resell[2] * 0.8
    ["Красная Куртка IBCA 'Supreme'"] = 187000,
    ["Чёрная Карго Куртка 'Supreme x TNF'"] = 25600,                       -- SupremeShirt12 Resell[2] * 0.8
    ["Жёлтая Футболка Mona Lisa 'Supreme'"] = 26500,
    ["Белая Футболка Kanji 'Supreme'"] = 27000,
    ["Бирюзовая Футболка 'Supreme x Trasher'"] = 12000,
    ["Жёлтая Футболка 'Supreme x Trasher'"] = 18000,
    ["Белая Футболка Gradient Arc Logo 'Supreme'"] = 14800,
    ["Белая Футболка 'Supreme x Anti Hero'"] = 12000,
    ["Красная Футболка Anarchy 'Supreme'"] = 11000,
    ["Чёрная Футболка Anarchy 'Supreme'"] = 11555,                          -- SupremeShirt11 Resell[2] * 0.8
    ["Жёлтая Футболка Swimmers 'Supreme'"] = 24500,
    ["Белая Футболка Ganesha 'Supreme'"] = 24500,
    ["Белая Футболка Nagoya Opening 'Supreme'"] = 177000,
    ["Футболка Box Logo 'Supreme'"] = 42000,
    ["Коричневая Футболка 666 'Supreme'"] = 29333,                          -- SupremeShirt10 Resell[2] * 0.8
    ["Белая Футболка Bling 'Supreme'"] = 18666,                             -- SupremeShirt19 Resell[2] * 0.8
    ["Белая Футболка Bling 'Supreme' (Alt)"] = 18666,                       -- запасной ключ, если названия в игре отличаются
    ["Коричневая Футболка Bandana Box Logo 'Supreme'"] = 39110,            -- SupremeShirt14 Resell[2] * 0.8
    ["Чёрная Футболка Bandana Box logo 'Supreme'"] = 39110,                -- SupremeShirt15 Resell[2] * 0.8
    ["Тёмно-Синяя Футболка Bandana Box Logo 'Supreme'"] = 39110,           -- SupremeShirt16 Resell[2] * 0.8
    ["Серая Футболка Blimp 'Supreme'"] = 27000,
    ["Белые Брюки 'Supreme X Brook Brothers'"] = 40800,                     -- SupremePants5 Resell[2] * 0.8
    ["Штаны Gonz 'Supreme'"] = 26800,                                       -- SupremePants6 Resell[2] * 0.8
    ["Камуфляжные Красные Штаны 'Supreme'"] = 26400,                        -- SupremePants4 Resell[2] * 0.8
    ["Камуфляжные Штаны Brooklyn 'Supreme'"] = 57200,                       -- SupremePants2 Resell[2] * 0.8
    ["Камуфляжные Фиолетовые Штаны 'Supreme'"] = 33600,                     -- SupremePants3 Resell[2] * 0.8
    ["Голубые Джинсы 'Supreme'"] = 10666,                                   -- SupremePants9 Resell[2] * 0.8
    ["Голубые Джинсы Gonz 'Supreme'"] = 11200,                              -- SupremePants7 Resell[2] * 0.8
    ["Принт Шорты Landscape 'Supreme'"] = 21333                             -- SupremePants8 Resell[2] * 0.8
}
local RickOwens_cloth_PriceTable = {
    ["Чёрная Футболка Pentagram 'Rick Owens'"] = 72000,                  -- rickshirt5 Resell[2] * 0.8
    ["Голубая Зип Худи Jason 'Rick Owens'"] = 80000,                     -- rickshirt18 Resell[2] * 0.8 (Context)
    ["Чёрное Худи Jason 'Rick Owens'"] = 66720,                          -- rickshirt11 Resell[2] * 0.8
    ["Чёрная Футболка Roet 'Rick Owens'"] = 19200,                       -- нет явного соответствия, оставляем
    ["Коричневая Худи Felpa 'Rick Owens'"] = 58666,                      -- rickshirt13 Resell[2] * 0.8
    ["Зелёная Худи 'Rick Owens'"] = 99999,                               -- без Price, оставляем
    ["Чёрная Футболка DRKSHDW 'Rick Owens'"] = 24000,                    -- rickshirt24 Resell[2] * 0.8
    ["Футболка 'Rick Owens × Stussy'"] = 51555,                          -- rickshirt9 Resell[2] * 0.8
    ["Тёмно-Коричневый Лонгслив 'Rick Owens x Champion'"] = 44000,       -- rickshirt20 Resell[2] * 0.8
    ["Джинсовая Куртка С Кожаными Рукавами 'Rick Owens'"] = 94400,       -- rickshirt17 Resell[2] * 0.8
    ["Чёрный Свитшот 'Rick Owens × Moncler'"] = 40000,                   -- rickshirt23 Resell[2] * 0.8
    ["Чёрная Футболка 'Rick Owens'"] = 29200,                            -- rickshirt21 Resell[2] * 0.8
    ["Футболка Poem 'Rick Owens'"] = 18000                               -- rickshirt12 Resell[2] * 0.8
}
local NikitaEfremov_misc_PriceTable = {
    ["Красная Зип Худи 'Takashi Murakami'"] = 35000,
    ["Белая Футболка 'Palm Angels'"] = 17500,
    ["Футболка 'Dior X Travis Scott'"] = 212000,
    ["Худи 'Fear Of God'"] = 25000,
    ["Футболка 'Rip N Dip'"] = 8000,
    ["Белая Футболка If you Reading 'Drake'"] = 11500,
    ["Джинсы Gamma 'Arcteryx'"] = 35000,
    ["Свитер Smiley 'Raf Simons'"] = 90000,
    ["Свитер"] = 99999,
    ["Протертые Джинсы 'Helmut Lang'"] = 38000, 
    ["Чёрное Зип Худи 'True Religion'"] = 8000,
    ["Спорт Джинсы 'Saint Laurent'"] = 73000,
    ["Серое Худи 'Yeezy X Gap'"] = 74000,
    ["Лонгслив 'Astroworld'"] = 54000, 
    ["Коричневые Штаны 'Travis Scott'"] = 105000,
    ["Рубашка 'Burberry'"] = 72000,
    ["Красные Джинсы 'Supreme X TNF'"] = 55000,
    ["Зип-Худи 'Evisu'"] = 20000,
    ["Худи Astroworld 'Travis Scott'"] = 38500,
    ["Худи Chemical engineer 'Caw Empt'"] = 38500
}
local TNF_cloth_PriceTable = {
    ["Пуховик Bubble 'The North Face X Supreme'"] = 53000,
    ["Пуховик Nuptse Retro 'The North Face'"] = 20000,
    ["Пуховик Tropical Camo 'The North Face'"] = 25000,
    ["Пуховик 'The North Face'"] = 999000,
    ["Куртка Mountain 'The North face'"] = 63000,
    ["Зелёный Пуховик Vintage 'The North Face'"] = 20000,
    ["Пуховик Printed Dryvent 'The North Face'"] = 34000,
    ["Рубашка Поло Beshtor 'The North Face'"] = 5000,
    ["Пуховик Nuptse 'The North Face'"] = 20000,
    ["Куртка Triple Skull 'The North Face'"] = 50000,
    ["КБ Пуховик 'The North Face X Supreme'"] = 65000,
    ["Пуховик Red Box 'The North Face'"] = 2000,
    ["Пуховик Retro Camo 'The North Face'"] = 21500,
    ["Пуховик Summit 'The North Face'"] = 18000,
    ["Свитшот Logo 'The North Face'"] = 1500,
    ["Пуховик Retro Nuptse 1996 'The North Face'"] = 25000,
    ["Пуховик INTERNATIONAL COLLECTION 'The North Face'"] = 28000,
    ["Ветровка Varsity 'The North Face X Supreme'"] = 23000,
    ["Пуховик Marble Light 'The North Face'"] = 29900,
    ["Худи Bear 'The North Face'"] = 8000,
    ["Худи Open Gate 'The North Face'"] = 8000,
    ["Куртка HomeSafe 'The North Face'"] = 6000,
    ["Футболка Easy 'The North Face'"] = 2600
}
local Moncler_cloth_PriceTable = {
    ["Оранжевый Жилет Tibb 'Moncler'"] = 110000,
    ["Красный Жилет DOWN BORMES 'Moncler'"] = 80000,
    ["Серый Жилет 'Moncler'"] = 37333,
    ["Пуховик Dronieres 'Moncler'"] = 225000,
    ["Пуховик 'Смешная Аналитика' 'Moncler'"] = 999000,
    ["Синий Жилет Tib 'Moncler'"] = 35000,
    ["Штаны Genius 'Moncler'"] = 50000,
    ["Штаны Logo 'Moncler'"] = 50000,
    ["Штаны Shiny 'Moncler X Palm Angels'"] = 45000,
    ["Штаны 'Moncler X Palm Angels'"] = 53000,
    ["Карго Штаны Day Namic Convertible 'Moncler'"] = 55000,
    ["Штаны Midnight 'Moncler'"] = 43000,
    ["Ветровка Slack Jacket 'Moncler'"] = 101000,
    ["Пуховик Panelled 'Moncler'"] = 160000,
    ["Розовый Жилет Quse 'Moncler'"] = 80000,
    ["Пуховик Gary Quilted 'Moncler'"] = 100000,
    ["Зип-Худи Logo 'Moncler'"] = 23000,
    ["Свитер Navy Logo Sweater 'Moncler'"] = 110000,
    ["Зип-Худи 'Moncler'"] = 80000,
    ["Зип-Худи Contrasting Stripes 'Moncler'"] = 65000,
    ["Белая Футболка Gym Tee 'Moncler'"] = 18000
}
local CPCompany_cloth_PriceTable = {
    ["Ветровка Pro Tec. Lens 'C.P. Company'"] = 25000,
    ["Белая Худи Diagonal Raised 'C.P. Company'"] = 20000,
    ["Свитшот Lens Sort 'C.P. Company'"] = 11000,
    ["Свитшот 'C.P. Company'"] = 99000,
    ["Свитшот Logo intarsia 'C.P. Company'"] = 20000,
    ["Голубой Худи Diagonal Fleece 'C.P. Company'"] = 21000,
    ["Худи Pro Tec Arm Lens 'C.P. Company'"] = 70000,
    ["Свитер Logo Pin 'C.P. Company'"] = 27000,
    ["Синий Жилет Chest Lens 'C.P. Company'"] = 81000,
    ["Пуховик D.D Shell 'C.P. Company'"] = 65000,
    ["Белая футболка Logo 'C.P. Company'"] = 14000,
    ["Куртка Eco Chrome 'C.P. Company'"] = 57000,
    ["Куртка Goggle 'C.P. Company'"] = 76000,
    ["Свитшот Logo Print 'C.P. Company'"] = 46000,
    ["Штаны 'C.P. Company'"] = 25000,
    ["Чёрная Куртка 'C.P. Company'"] = 20000
}
local Nike_cloth_PriceTable = {
    ["Тёмно-Синий Свитер 'Nike'"] = 4000,
    ["Тёмно-Синяя Худи 'Nike'"] = 5000,
    ["Чёрно Синяя Футболка 'Nike'"] = 1000,
    ["Красно Бежевая Футболка 'Nike'"] = 1000,
    ["Серый Свитер 'Nike'"] = 3000,
    ["Серая Кофта 'Nike'"] = 100000,
    ["Серая Худи 'Nike'"] = 2000,
    ["Чёрная Толстовка 'Nike'"] = 4000,
    ["Чёрная Худи 'Nike'"] = 3000,
    ["Голубой 'Nike' Tech Fleece"] = 2000,
    ["Красный Свитер 'Nike'"] = 3000,
    ["Бежевая Худи 'Nike'"] = 2000,
    ["Красная Худи 'Nike'"] = 2000,
    ["Тёмно-Синяя Куртка 'Nike'"] = 8000,
    ["Серые Штаны 'Nike'"] = 1000,
    ["Чёрные Штаны 'Nike'"] = 2000,
    ["Чёрные Джинсы 'Nike'"] = 2000,
    ["Синие Штаны 'Nike'"] = 2000,
    -- NikeSuit1/2/3 из Config_Export (Resell[2] * 0.8)
    ["Оранжевая Тренажёрная Курта 'Nike'"] = 8888,
    ["Чёрная Тренажёрная Куртка 'Nike'"] = 8888,
    ["Бежавая тренажёрная Куртка 'Nike'"] = 8000,
    ["Спортивные Штаны 'Nike'"] = 1600
}
local Apple_PriceTable = {
    ["Телефон 'iPhone 13'"] = 53000,           -- iphone13_w Resell[2] * 0.8
    ["Телефон 'iPhone 13 Pro Max'"] = 64000,   -- iphone13pm_b Resell[2] * 0.8
    ["Телефон 'iPhone 14'"] = 60000,           -- iphone14_b/iphone14_rr Resell[2] * 0.8
    ["Телефон 'iPhone 14 Pro Max'"] = 83000,   -- iphone14pm_p Resell[2] * 0.8
    ["Телефон 'iPhone 15'"] = 67000,           -- iphone15_b Resell[2] * 0.8
    ["Телефон 'iPhone 15 Pro Max'"] = 168000,  -- iphone15_pm_nt Resell[2] * 0.8
    ["Телефон 'iPhone 17 Pro'"] = 283500,      -- iphone_17_po Resell[2] * 0.8
    ["Телефон 'iPhone 17 Pro LIT'"] = 763500   -- iphone_17_plit Resell[2] * 0.8
}
local SmeshnieCheni_PriceTable = {
    ["Чёрные Порванные Джинсы"] = 62,
    ["Зелёная Зипка 'Смешная Аналитика'"] = 9900,
    ["Коричневые Штаны"] = 250,
    ["Тёмно Синие Джинсы"] = 250,
    ["Осветлённые Джинсы"] = 110,
    ["Серые Штаны"] = 60,
    ["Мятые Синие Джинсы"] = 30,
    ["Чёрные Штаны 'Cheks'"] = 90,
    ["Чёрные Школьные Брюки"] = 180,
    ["Кожаная Куртка 'Hard to control'"] = 50,
    ["Чёрная Футболка 'Free Your Soul'"] = 100,
    ["Чёрная Футболка 'Gothic'"] = 100,
    ["Серый Свитшот"] = 60,
    ["Чёрный Свитшот 'sloeber'"] = 60,
    ["Чёрное Худи 'mask'"] = 70,
    ["Синяя Худи"] = 100,
    ["Ковбойская Рубашка В Клеточку"] = 100,
    ["Чёрная Футболка 'Cute'"] = 100,
    ["Чёрная Футболка С Бантиком"] = 100,
    ["Белая Футболка"] = 100,
    ["Джинсы 'RedStar'"] = 170
}

local Luxury_PriceTable = {
    ["Футболка 'Givenchy'"] = 6000,
    ["Футболка 'Amiri'"] = 11000,
    ["Футболка 'Dior'"] = 37000,
    ["Свитшот 'Givenchy'"] = 13000,
    ["Худи 'Amiri'"] = 11000
}
local Xiaomi_PriceTable = {
    ["Xiaomi Redmi Note 8"] = 14555           -- Redmi1_b Resell[1]
}

local Second_cloth_PriceTable = {
    ["Коричневые Штаны"] = 250,                -- SecondPants1 Stock[1]
    ["Тёмно Синие Джинсы"] = 250,             -- SecondPants2 Stock[1]
    ["Осветлённые Джинсы"] = 110,            -- SecondPants3 Stock[1]
    ["Серые Штаны"] = 60,                     -- SecondPants4 Stock[1]
    ["Мятые Синие Джинсы"] = 30,             -- SecondPants5 Stock[1]
    ["Чёрные Штаны 'Cheks'"] = 90,           -- SecondPants6 Stock[1]
    ["Чёрные Школьные Брюки"] = 180,         -- SecondPants7 Stock[1]
    ["Кожаная Куртка 'Hard to control'"] = 50,         -- Second1 Stock[1]
    ["Чёрная Футболка 'Free Your Soul'"] = 100,        -- Second10 Stock[1]
    ["Чёрная Футболка 'Gothic'"] = 100,                -- Second11 Stock[1]
    ["Серый Свитшот"] = 60,                            -- Second12 Stock[1]
    ["Чёрный Свитшот 'sloeber'"] = 60,                 -- Second13 Stock[1]
    ["Чёрное Худи 'mask'"] = 70,                       -- Second14 Stock[1]
    ["Синяя Худи"] = 100,                              -- Second15 Stock[1]
    ["Ковбойская Рубашка В Клеточку"] = 100,           -- Second16 Stock[1]
    ["Чёрная Футболка 'Cute'"] = 100,                  -- Second18 Stock[1]
    ["Чёрная Футболка С Бантиком"] = 100,              -- Second19 Stock[1]
    ["Белая Футболка"] = 100                           -- Second20 Stock[1]
}
local generalBrandRules = {
    { brandName = "Maison Margiela", keyword = "Maison Margiela", maxPrice = 0, alwaysPick = true }, -- maxPrice is ignored if alwaysPick is true
    { brandName = "Moncler Pants", keyword = "Штаны 'Moncler'", maxPrice = 0, alwaysPick = true },
    { brandName = "Moncler x Palm Angels Pants", keyword = "Штаны 'Moncler X Palm Angels'", maxPrice = 0, alwaysPick = true }
}

local masterPriceTable = {}
local itemBrandIndex = {}
local normalizedBrandIndex = {}
local normalizedPriceIndex = {}
local function normalizeName(s)
    s = tostring(s or "")
    s = s:gsub("[‘’‛`´]", "'")
    s = s:gsub('[“”„"]', '"')
    s = s:lower()
    s = s:gsub("ё", "е")
    -- приводим часто путаемые кириллические буквы к латинице для брендов (с/p/a/o/e/x)
    s = s:gsub("с", "c") -- кириллическая "с" -> латинская "c"
    s = s:gsub("р", "p") -- кириллическая "р" -> латинская "p"
    s = s:gsub("а", "a") -- кириллическая "а" -> латинская "a"
    s = s:gsub("о", "o") -- кириллическая "о" -> латинская "o"
    s = s:gsub("е", "e") -- кириллическая "е" -> латинская "e"
    s = s:gsub("х", "x") -- кириллическая "х" -> латинская "x"
    s = s:gsub("[%-%–—]+", "-")
    s = s:gsub("[^%w%s%'\"%-]+", " ")
    s = s:gsub("%s+", " ")
    s = s:gsub("%s*%-+%s*", "-")
    s = s:gsub("^%s+", ""):gsub("%s+$", "")
    return s
end
task.spawn(function()
    local tablesToMerge = {
        {tbl=Sport_cloth_PriceTable, brand="SportMaster"},
        {tbl=Adidas_cloth_PriceTable, brand="Adidas"},
        {tbl=Bape_cloth_PriceTable, brand="Bape"},
        {tbl=ChromeHearts_cloth_PriceTable, brand="Chrome Hearts"},
        {tbl=Vetements_cloth_PriceTable, brand="Vetements"},
        {tbl=Zara_cloth_PriceTable, brand="Zara"},
        {tbl=StoneIsland_cloth_PriceTable, brand="Stone Island"},
        {tbl=Balenciaga_cloth_PriceTable, brand="Balenciaga"},
        {tbl=LouisVuitton_cloth_PriceTable, brand="Louis Vuitton"},
        {tbl=Gucci_cloth_PriceTable, brand="Gucci"},
        {tbl=Supreme_cloth_PriceTable, brand="Supreme"},
        {tbl=RickOwens_cloth_PriceTable, brand="Rick Owens"},
        {tbl=NikitaEfremov_misc_PriceTable, brand="Nikita Efremov"},
        {tbl=TNF_cloth_PriceTable, brand="TNF"},
        {tbl=Moncler_cloth_PriceTable, brand="Moncler"},
        {tbl=CPCompany_cloth_PriceTable, brand="CP Company"},
        {tbl=Nike_cloth_PriceTable, brand="Nike"},
        {tbl=Apple_PriceTable, brand="Apple"},
        {tbl=SmeshnieCheni_PriceTable, brand="Смешные цены"},
        {tbl=Luxury_PriceTable, brand="Luxury"},
        {tbl=Xiaomi_PriceTable, brand="Xiaomi"},
        {tbl=Second_cloth_PriceTable, brand="Second"},
    }
    for _, entry in ipairs(tablesToMerge) do
        for name, price in pairs(entry.tbl) do
            masterPriceTable[name] = price
            itemBrandIndex[name] = entry.brand
            local norm = normalizeName(name)
            normalizedBrandIndex[norm] = entry.brand
            normalizedPriceIndex[norm] = price
        end
        task.wait()
    end
end)
--#endregion Clothing Price Data

local HttpService = game:GetService("HttpService")
local lp = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")
local ProximityPromptService = game:GetService("ProximityPromptService")
local UserInputService = game:GetService("UserInputService")

-- Auto-Sell requires from the new script
local getPlayerData = game:GetService("ReplicatedStorage"):FindFirstChild("GameNetwork"):FindFirstChild("ServerNetwork"):FindFirstChild("GetPlayerData");
local sellClothing = game:GetService("ReplicatedStorage"):FindFirstChild("GameNetwork"):FindFirstChild("ServerNetwork"):FindFirstChild("SellClothing");

--#endregion Backend Logic & Data

-- ====================================================================
--                         [ UI Initialization ]
-- ====================================================================

local Window = Library:CreateWindow({
	Title = "Casual Stock PRIVATE",
	Footer = "by qkaspq",
	Icon = 10688448740,
	Center = true,
	AutoShow = true,
	Resizable = false,
	ShowCustomCursor = true,
	NotifySide = "Right",
})

-- ====================================================================
--                           [ UI Structure ]
-- ====================================================================

local Tabs = {
    Info = Window:AddTab("Инфо", "info"),
    ESPClothes = Window:AddTab("ESP Одежда", "shirt"),
    ESPPlayers = Window:AddTab("ESP Игроки", "users"),
    ESPDropped = Window:AddTab("ESP Дроп", "package"),
    AutoBuy = Window:AddTab("Авто покупка", "shopping-cart"),
    AutoSell = Window:AddTab("Инвентарь", "tag"),
    SkinChanger = Window:AddTab("Скинчейнджер", "shirt"),
    Player = Window:AddTab("Сервер", "server"),
    Misc = Window:AddTab("Разное", "settings-2"),
    BrandsInfo = Window:AddTab("Гайд брендов", "book-open"),
    Webhook = Window:AddTab("Вебхук", "link"),
    UISettings = Window:AddTab("Настройки интерфейса", "settings"),
}

-- ====================================================================
--                         [ Features Logic ]
-- ====================================================================

--#region Info Tab
do
    local InfoGroup = Tabs.Info:AddLeftGroupbox("Общая информация")
    
    InfoGroup:AddImage("VexusIcon", {
        Image = "http://www.roblox.com/asset/?id=113001608845705",
        Transparency = 0,
        Color = Color3.new(1, 1, 1),
        RectOffset = Vector2.zero,
        RectSize = Vector2.zero,
        ScaleType = Enum.ScaleType.Fit,
        Height = 90,
    })
    
    InfoGroup:AddLabel("<font size='16'>Создатель</font>\nqkaspq", true)
    
    InfoGroup:AddLabel("<font size='16'>Изменения</font>\n" .. table.concat({
        "Добавлено:",
        "[+] Скинчейнджер",
        "[+] Авто Оплата",
        "[+] Убрать Ограничение Одежд",
        "[+] Анти Лаги",
        "[+] Бесконечный Прыжок",
        "[+] Убрать Ограничение FPS",
        "",
        "Изменено:",
        "[/] Интерфейс полностью на русском языке",
        "[/] Интерфейс стал компактнее и удобнее",
        "[/] У управления инвентаря теперь автоматизированно обновление",
        "[/] Переделан дизайн у Статистики",
        "[/] Переделан дизайн у Бренд Гайда",
        "",
        "Удалено:",
        "[-] Авто Кража",
        "[-] Полёт",
    }, "\n"), true)

    InfoGroup:AddDivider()
    
    local StatsGroup = Tabs.Info:AddRightGroupbox("Статистика")
    local TweenService = game:GetService("TweenService")
    local UserInputService = game:GetService("UserInputService")
    local statsGui, statsFrame, statsContainer
    local isStatsGuiOpen = false
    local statLabels = {}

    local function createStatsGui()
        statsGui = Instance.new("ScreenGui")
        statsGui.Name = "LiveStatsGui"
        statsGui.ResetOnSpawn = false
        statsGui.Enabled = false

        statsFrame = Instance.new("Frame", statsGui)
        statsFrame.Name = "MainFrame"
        statsFrame.Size = UDim2.new(0, 340, 0, 480)
        statsFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        statsFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
        statsFrame.BorderSizePixel = 0
        statsFrame.AnchorPoint = Vector2.new(0.5, 0.5)

        local corner = Instance.new("UICorner", statsFrame)
        corner.CornerRadius = UDim.new(0, 8)
        local stroke = Instance.new("UIStroke", statsFrame)
        stroke.Color = Color3.fromRGB(70, 70, 70)
        stroke.Thickness = 1

        local titleLabel = Instance.new("TextLabel", statsFrame)
        titleLabel.Name = "Title"
        titleLabel.Size = UDim2.new(1, 0, 0, 40)
        titleLabel.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
        titleLabel.Text = "Статистика"
        titleLabel.Font = Enum.Font.SourceSansBold
        titleLabel.TextSize = 18
        titleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
        local titleCorner = Instance.new("UICorner", titleLabel)
        titleCorner.CornerRadius = UDim.new(0, 8)

        local closeButton = Instance.new("TextButton", titleLabel)
        closeButton.Name = "CloseButton"
        closeButton.Size = UDim2.new(0, 30, 0, 30)
        closeButton.Position = UDim2.new(1, -35, 0.5, -15)
        closeButton.Text = "X"
        closeButton.Font = Enum.Font.SourceSansBold
        closeButton.TextSize = 16
        closeButton.TextColor3 = Color3.fromRGB(200, 200, 200)
        closeButton.BackgroundTransparency = 1
        closeButton.ZIndex = 2
        
        local subtitle = Instance.new("TextLabel", statsFrame)
        subtitle.Name = "Subtitle"
        subtitle.Size = UDim2.new(1, -20, 0, 24)
        subtitle.Position = UDim2.new(0, 10, 0, 40)
        subtitle.BackgroundTransparency = 1
        subtitle.Font = Enum.Font.SourceSans
        subtitle.TextSize = 14
        subtitle.TextColor3 = Color3.fromRGB(190, 190, 190)
        subtitle.TextXAlignment = Enum.TextXAlignment.Left
        subtitle.Text = "Это ваша информация и статистика."

        statsContainer = Instance.new("ScrollingFrame", statsFrame)
        statsContainer.Size = UDim2.new(1, 0, 1, -64)
        statsContainer.Position = UDim2.new(0, 0, 0, 64)
        statsContainer.BackgroundTransparency = 1
        statsContainer.BorderSizePixel = 0
        statsContainer.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 80)
        statsContainer.ScrollBarThickness = 6
        statsContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
        
        local listLayout = Instance.new("UIListLayout", statsContainer)
        listLayout.Padding = UDim.new(0, 10)
        listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

        local contentPadding = Instance.new("UIPadding", statsContainer)
        contentPadding.PaddingLeft = UDim.new(0, 10)
        contentPadding.PaddingRight = UDim.new(0, 10)
        contentPadding.PaddingTop = UDim.new(0, 10)

        local Players = game:GetService("Players")
        local lp = Players.LocalPlayer
        local accountCard = Instance.new("Frame", statsContainer)
        accountCard.Name = "AccountInfoCard"
        accountCard.LayoutOrder = 0
        accountCard.Size = UDim2.new(1, 0, 0, 70)
        accountCard.BackgroundTransparency = 0
        accountCard.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
        accountCard.BorderSizePixel = 0
        local accCorner = Instance.new("UICorner", accountCard)
        accCorner.CornerRadius = UDim.new(0, 6)

        local avatar = Instance.new("ImageLabel", accountCard)
        avatar.Name = "Avatar"
        avatar.BackgroundTransparency = 1
        avatar.Size = UDim2.new(0, 50, 0, 50)
        avatar.Position = UDim2.new(0, 10, 0, 10)
        avatar.Image = ""
        avatar.ScaleType = Enum.ScaleType.Fit

        local accText = Instance.new("TextLabel", accountCard)
        accText.Name = "AccountText"
        accText.BackgroundTransparency = 1
        accText.Position = UDim2.new(0, 70, 0, 10)
        accText.Size = UDim2.new(1, -80, 1, -20)
        accText.RichText = true
        accText.Font = Enum.Font.SourceSans
        accText.TextSize = 16
        accText.TextColor3 = Color3.fromRGB(230, 230, 230)
        accText.TextXAlignment = Enum.TextXAlignment.Left
        accText.TextYAlignment = Enum.TextYAlignment.Top
        accText.TextWrapped = true
        accText.Text = string.format("<font size='16'>Аккаунт</font>\n%s (ID: %s)", tostring(lp and lp.Name or "?"), tostring(lp and lp.UserId or "?"))

        task.spawn(function()
            if not (lp and lp.UserId) then return end
            local ok, url = pcall(function()
                return Players:GetUserThumbnailAsync(lp.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
            end)
            if ok and url and avatar then
                avatar.Image = url
            end
        end)

        local statNames = {
            "CashRaisedLabel", "CashPerStockLabel", "AvgPerStockLabel", "EstPerDayLabel",
            "BalanceLabel", "TimePlayedLabel", "StockInfoLabel", "PlayersInfoLabel", "NetInfoLabel", "ServerInfoLabel"
        }
        local initialTexts = {
            "<font size='16'>Общий доход</font>\nСчитаю...",
            "<font size='16'>Доход за сток</font>\nЖду новый сток...",
            "<font size='16'>Средний доход за сток</font>\n<font color='#FFFFFF'>0 руб.</font>",
            "<font size='16'>Примерно за день</font>\n<font color='#FFFFFF'>0 руб.</font>",
            "<font size='16'>Баланс (Рубли)</font>\nЗагрузка...",
            "<font size='16'>Время в игре</font>\n00:00:00",
            "<font size='16'>Сток</font>\nЗагрузка...",
            "<font size='16'>Игроки</font>\nЗагрузка...",
            "<font size='16'>Сеть</font>\nПинг: ...",
            "<font size='16'>Сессия</font>\nЗагрузка..."
        }

        for i, name in ipairs(statNames) do
            local label = Instance.new("TextLabel", statsContainer)
            label.Name = name
            label.LayoutOrder = i
            label.Size = UDim2.new(1, 0, 0, 44)
            label.AutomaticSize = Enum.AutomaticSize.Y
            label.Text = initialTexts[i]
            label.RichText = true
            label.Font = Enum.Font.SourceSans
            label.TextSize = 16
            label.TextColor3 = Color3.fromRGB(230, 230, 230)
            label.BackgroundTransparency = 0
            label.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
            label.TextXAlignment = Enum.TextXAlignment.Left
            local lblCorner = Instance.new("UICorner", label)
            lblCorner.CornerRadius = UDim.new(0, 6)
            local lblPad = Instance.new("UIPadding", label)
            lblPad.PaddingLeft = UDim.new(0, 10)
            lblPad.PaddingRight = UDim.new(0, 10)
            lblPad.PaddingTop = UDim.new(0, 8)
            lblPad.PaddingBottom = UDim.new(0, 8)
            statLabels[name] = label
        end

        local copyButton = Instance.new("TextButton", statsContainer)
        copyButton.Name = "CopyStatsButton"
        copyButton.LayoutOrder = 100
        copyButton.Size = UDim2.new(1, 0, 0, 35)
        copyButton.BackgroundColor3 = Color3.fromRGB(60, 120, 240)
        copyButton.Text = "Скопировать статистику"
        copyButton.Font = Enum.Font.SourceSansBold
        copyButton.TextSize = 16
        copyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        local copyCorner = Instance.new("UICorner", copyButton)
        copyCorner.CornerRadius = UDim.new(0, 6)
        statLabels.CopyStatsButton = copyButton

        local copyProgressButton = Instance.new("TextButton", statsContainer)
        copyProgressButton.Name = "CopyProgressButton"
        copyProgressButton.LayoutOrder = 101
        copyProgressButton.Size = UDim2.new(1, 0, 0, 35)
        copyProgressButton.BackgroundColor3 = Color3.fromRGB(80, 160, 90)
        copyProgressButton.Text = "Скопировать прогресс"
        copyProgressButton.Font = Enum.Font.SourceSansBold
        copyProgressButton.TextSize = 16
        copyProgressButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        local cpCorner = Instance.new("UICorner", copyProgressButton)
        cpCorner.CornerRadius = UDim.new(0, 6)
        statLabels.CopyProgressButton = copyProgressButton

        local resetButton = Instance.new("TextButton", statsContainer)
        resetButton.Name = "ResetButton"
        resetButton.LayoutOrder = 102
        resetButton.Size = UDim2.new(1, 0, 0, 35)
        resetButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        resetButton.Text = "Сбросить прогресс дохода"
        resetButton.Font = Enum.Font.SourceSansBold
        resetButton.TextSize = 16
        resetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        local btnCorner = Instance.new("UICorner", resetButton)
        btnCorner.CornerRadius = UDim.new(0, 6)
        statLabels.ResetButton = resetButton

        -- Draggable (перетаскивание за любое место окна Live Stats)
        local dragging = false
        local dragStart, startPos

        local function beginStatsDrag(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true
                dragStart = input.Position
                startPos = statsFrame.Position
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then dragging = false end
                end)
            end
        end

        titleLabel.InputBegan:Connect(beginStatsDrag)
        statsFrame.InputBegan:Connect(beginStatsDrag)

        UserInputService.InputChanged:Connect(function(input)
            if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - dragStart
                statsFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
        
        local function animate(open)
            isStatsGuiOpen = open
            if open then
                statsGui.Enabled = true
                statsFrame.Size = UDim2.new(0, 340, 0, 0)
                TweenService:Create(statsFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 340, 0, 480)}):Play()
            else
                local tween = TweenService:Create(statsFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0, 340, 0, 0)})
                tween.Completed:Connect(function() statsGui.Enabled = false end)
                tween:Play()
            end
        end
        closeButton.MouseButton1Click:Connect(function() animate(false) end)
        
        StatsGroup:AddButton({ Text = "Открыть статистику", Tooltip="Открывает окно статистики.", Func = function() animate(true) end })
        statsGui.Parent = game:GetService("CoreGui")
        Library:OnUnload(function() if statsGui then statsGui:Destroy() end end)
    end

    createStatsGui()
    
    local rubleStat
task.spawn(function()
    local player = game:GetService("Players").LocalPlayer
    local leaderstats = player:WaitForChild("leaderstats")
        rubleStat = leaderstats and leaderstats:WaitForChild("Рубли", 10)

    if not rubleStat then
            if statLabels.CashRaisedLabel then statLabels.CashRaisedLabel.Text = "<font size='16'>Общий доход</font>\nСтат 'Рубли' не найден!" end
        return
    end

    local saveDataFile = "casualstock_cash_progress.json"
    local initialCash
    local setClipboardSafe

        local function saveProgress(cashValue) pcall(function() writefile(saveDataFile, HttpService:JSONEncode({initialCash = cashValue})) end) end
    
    if isfile and isfile(saveDataFile) then
        local success, fileContent = pcall(readfile, saveDataFile)
        if success and fileContent and fileContent ~= "" then
            local decodedSuccess, data = pcall(function() return HttpService:JSONDecode(fileContent) end)
                if decodedSuccess and data and data.initialCash then initialCash = data.initialCash end
        end
    end
    
    if not initialCash then
        initialCash = rubleStat.Value
        saveProgress(initialCash)
    end

        if statLabels.CopyStatsButton then
            statLabels.CopyStatsButton.MouseButton1Click:Connect(function()
                local function stripRich(text)
                    text = tostring(text or "")
                    text = text:gsub("<[^>]->", "")
                    return text
                end

                local lines = {}
                lines[#lines + 1] = "Casual Stock - Статистика"
                lines[#lines + 1] = "PlaceId: " .. tostring(game.PlaceId)
                lines[#lines + 1] = "Сервер: " .. tostring(game.JobId)
                lines[#lines + 1] = "Игрок: " .. tostring(player.Name)
                lines[#lines + 1] = ""

                for _, key in ipairs({"BalanceLabel","CashRaisedLabel","CashPerStockLabel","TimePlayedLabel","StockInfoLabel","PlayersInfoLabel","NetInfoLabel","ServerInfoLabel"}) do
                    local lbl = statLabels[key]
                    if lbl and lbl.Text then
                        lines[#lines + 1] = stripRich(lbl.Text)
                        lines[#lines + 1] = ""
                    end
                end

                local finalText = table.concat(lines, "\n")
                if setClipboardSafe(finalText) then
                    Library:Notify({ Title = "Статистика", Description = "Скопировано в буфер обмена", Time = 2 })
                else
                    Library:Notify({ Title = "Статистика", Description = "Не удалось скопировать", Time = 3 })
                end
            end)
        end

        if statLabels.CopyProgressButton then
            statLabels.CopyProgressButton.MouseButton1Click:Connect(function()
                local function stripRich(text)
                    text = tostring(text or "")
                    text = text:gsub("<[^>]->", "")
                    return text
                end

                local parts = {}
                parts[#parts + 1] = "Casual Stock - Прогресс"
                parts[#parts + 1] = "Игрок: " .. tostring(player.Name)
                parts[#parts + 1] = "Сервер: " .. tostring(game.JobId)
                parts[#parts + 1] = ""
                if statLabels.CashRaisedLabel then parts[#parts + 1] = stripRich(statLabels.CashRaisedLabel.Text) end
                if statLabels.CashPerStockLabel then parts[#parts + 1] = stripRich(statLabels.CashPerStockLabel.Text) end
                if statLabels.BalanceLabel then parts[#parts + 1] = stripRich(statLabels.BalanceLabel.Text) end
                local finalText = table.concat(parts, "\n")

                if setClipboardSafe(finalText) then
                    Library:Notify({ Title = "Прогресс", Description = "Скопировано в буфер обмена", Time = 2 })
                else
                    Library:Notify({ Title = "Прогресс", Description = "Не удалось скопировать", Time = 3 })
                end
            end)
        end

        if statLabels.ResetButton then
            statLabels.ResetButton.MouseButton1Click:Connect(function()
                initialCash = rubleStat.Value
                saveProgress(initialCash)
                if statLabels.CashRaisedLabel then statLabels.CashRaisedLabel.Text = "<font size='16'>Общий доход</font>\n<font color='#00FF7F'>+0 руб.</font>" end
                Library:Notify({ Title = "Сброс", Description = "Счётчик дохода сброшен.", Time = 3 })
            end)
        end

        local function toCp1251ForClipboard(str)
            str = tostring(str or "")
            str = str:gsub("₽", "руб.")
            local out = table.create(#str)
            local n = 0
            for _, code in utf8.codes(str) do
                local b = nil
                -- ASCII
                if code >= 0 and code <= 0x7F then
                    b = code
                -- А-Я
                elseif code >= 0x410 and code <= 0x42F then
                    b = 0xC0 + (code - 0x410)
                -- а-я
                elseif code >= 0x430 and code <= 0x44F then
                    b = 0xE0 + (code - 0x430)
                elseif code == 0x401 then -- Ё
                    b = 0xA8
                elseif code == 0x451 then -- ё
                    b = 0xB8
                elseif code == 0x2116 then -- №
                    b = 0xB9
                elseif code == 0x00AB then -- «
                    b = 0xAB
                elseif code == 0x00BB then -- »
                    b = 0xBB
                elseif code == 0x2014 then -- —
                    b = 0x97
                elseif code == 0x2013 then -- –
                    b = 0x96
                elseif code == 0x2026 then -- …
                    b = 0x85
                elseif code == 0x2022 then -- •
                    b = 0x95
                end
                n += 1
                out[n] = string.char(b or 0x3F)
            end
            return table.concat(out, "", 1, n)
        end

        setClipboardSafe = function(text)
            local clipboardFn = setclipboard or toclipboard
            if not clipboardFn then
                return false
            end
            local converted = toCp1251ForClipboard(text)
            local ok = pcall(function() clipboardFn(converted) end)
            return ok
        end

        -- Start the update loop
    local startTime = tick()
        local cashAtStockStart = nil
        local stockCount = 0
        local stockTotalDiff = 0
        local lastStockStatusText = ""
        local lastCashTick = nil
        task.spawn(function()
            while task.wait(1) and Library and not Library.Unloaded do
                if not isStatsGuiOpen then continue end

                local ok, currentCash = pcall(function() return rubleStat.Value end)
                if not ok or type(currentCash) ~= "number" then
                    continue -- If we can't get a valid number for cash, skip this entire update cycle.
                end

        local elapsedTime = tick() - startTime
        local hours = math.floor(elapsedTime / 3600)
        local minutes = math.floor((elapsedTime % 3600) / 60)
        local seconds = math.floor(elapsedTime % 60)
                if statLabels.TimePlayedLabel then statLabels.TimePlayedLabel.Text = string.format("<font size='16'>Время в игре</font>\n%02d:%02d:%02d", hours, minutes, seconds) end

                if statLabels.BalanceLabel then statLabels.BalanceLabel.Text = string.format("<font size='16'>Баланс (Рубли)</font>\n%s руб.", tostring(currentCash)) end
                
                if type(initialCash) == "number" then
        local cashDifference = currentCash - initialCash
        local sign = cashDifference >= 0 and "+" or "-"
        local color = cashDifference >= 0 and "#00FF7F" or "#FF5733"
        if statLabels.CashRaisedLabel then
            statLabels.CashRaisedLabel.Text = string.format(
                "<font size='16'>Общий доход</font>\n<font color='%s'>%s%s руб.</font>",
                color,
                sign,
                tostring(math.abs(cashDifference))
            )
        end

        if statLabels.EstPerDayLabel then
            if stockCount and stockCount > 0 then
                local cycleSeconds = (10 * 60) + (1 * 60)
                local stocksPerDay = 86400 / cycleSeconds
                local avg = stockTotalDiff / stockCount
                local perDay = avg * stocksPerDay
                local daySign = perDay >= 0 and "+" or "-"
                local dayColor = perDay >= 0 and "#00FF7F" or "#FF5733"
                statLabels.EstPerDayLabel.Text = string.format(
                    "<font size='16'>Примерно за день</font>\n<font color='%s'>%s%s руб.</font>",
                    dayColor,
                    daySign,
                    tostring(math.floor(math.abs(perDay)))
                )
            else
                statLabels.EstPerDayLabel.Text = "<font size='16'>Примерно за день</font>\nЖду 1 сток..."
            end
        end
        end
                
            local fps = math.floor(1 / math.max(0.001, RunService.Heartbeat:Wait()))
            local stats = game:GetService("Stats")
            local pingStr = "N/A"
            pcall(function()
                local net = stats and stats.Network
                local pingItem = net and net.ServerStatsItem and net.ServerStatsItem["Data Ping"]
                if pingItem then pingStr = pingItem:GetValueString() end
            end)
                if statLabels.PlayersInfoLabel then statLabels.PlayersInfoLabel.Text = string.format("<font size='16'>Игроки</font>\n%d/%d", #game:GetService("Players"):GetPlayers(), game:GetService("Players").MaxPlayers) end
                if statLabels.NetInfoLabel then statLabels.NetInfoLabel.Text = string.format("<font size='16'>Сеть</font>\nПинг: %s", pingStr) end
                
                local stockOk, stockText = pcall(function() return player.PlayerGui.PlayerScreen.Screen.LeftTab.GameStatus.Text end)
                if stockOk and stockText then
                    if statLabels.StockInfoLabel then statLabels.StockInfoLabel.Text = string.format("<font size='16'>Сток</font>\n%s", stockText) end
                    
                    local currentStockPhase = stockText:gsub("[0-9:%.%s]", "")
                    local lastStockPhase = lastStockStatusText:gsub("[0-9:%.%s]", "")
                    if currentStockPhase ~= lastStockPhase then
                        if type(cashAtStockStart) == "number" then
                            local prevDiff = currentCash - cashAtStockStart
                            stockTotalDiff = stockTotalDiff + prevDiff
                            stockCount = stockCount + 1
                            if statLabels.AvgPerStockLabel and stockCount > 0 then
                                local avg = stockTotalDiff / stockCount
                                local avgSign = avg >= 0 and "+" or "-"
                                local avgColor = avg >= 0 and "#00FF7F" or "#FF5733"
                                statLabels.AvgPerStockLabel.Text = string.format(
                                    "<font size='16'>Средний доход за сток</font>\n<font color='%s'>%s%s руб.</font>",
                                    avgColor,
                                    avgSign,
                                    tostring(math.floor(math.abs(avg)))
                                )
                            end
                        end
                        cashAtStockStart = currentCash
                        lastCashTick = currentCash
                        if statLabels.CashPerStockLabel then statLabels.CashPerStockLabel.Text = string.format("<font size='16'>Доход за сток</font>\n<font color='#FFFFFF'>+0 руб.</font>") end
                    end
                    lastStockStatusText = stockText
                end

                if type(cashAtStockStart) == "number" then
                    local stockCashDiff = currentCash - cashAtStockStart
                    local stockSign = stockCashDiff >= 0 and "+" or ""
                    local stockColor = stockCashDiff >= 0 and "#00FF7F" or "#FF5733"

                    if statLabels.CashPerStockLabel then
                        local perTickDelta = (type(lastCashTick) == "number") and (currentCash - lastCashTick) or 0
                        local deltaSign = perTickDelta >= 0 and "+" or ""
                        local deltaColor = perTickDelta >= 0 and "#00FF7F" or "#FF5333"
                        local deltaText = ""
                        if perTickDelta ~= 0 then
                            deltaText = string.format(" <font color='%s'>(%s%s руб.)</font>", deltaColor, deltaSign, tostring(math.abs(perTickDelta)))
                        end
                        statLabels.CashPerStockLabel.Text = string.format(
                            "<font size='16'>Доход за сток</font>\n<font color='%s'>%s%s руб.</font>%s",
                            stockColor,
                            stockSign,
                            tostring(math.abs(stockCashDiff)),
                            deltaText
                        )
                        lastCashTick = currentCash
                    end
                end
                
                if statLabels.ServerInfoLabel then
                    statLabels.ServerInfoLabel.Text = string.format("<font size='16'>Сессия</font>\nPlaceId: %s\nСервер: %s\nИгрок: %s (%s)\nВозраст аккаунта: %s дней\nFPS: %d",
                        tostring(game.PlaceId), tostring(game.JobId), player.Name, player.DisplayName or player.Name, tostring(player.AccountAge), fps)
                end
            end
        end)
    end)
end
--#endregion Info Tab

--#region ESP Clothes Tab
    local ESPGroup = Tabs.ESPClothes:AddLeftGroupbox("Настройки ESP")

    local espPayOffClothesEnabled = false
    local espPayOffUpdateLoopActive = false
    local espBalanceFilterEnabled = false
    -- Фильтр по брендам для ESP (по умолчанию все включены)
    local espAvailableBrands = {
        "SportMaster","Adidas","Bape","Chrome Hearts","Vetements","Zara","Stone Island","Balenciaga",
        "Louis Vuitton","Gucci","Supreme","Rick Owens","Nikita Efremov","TNF","Moncler","CP Company",
        "Nike","Apple","Смешные цены","Luxury","Xiaomi","Second"
    }
    local espBrandFilter = {}
    for _, brand in ipairs(espAvailableBrands) do
        espBrandFilter[brand] = true
    end
    local activeESPCache = {} 
    local espPool = {} 
    local espUpdateFrequency = 0.5 
    local espMaxDistance = 60 
    local espHighlightEnabled = true
    local espStyle = "1" -- Defau
    local TweenService = game:GetService("TweenService")

    -- Мульти-дропдаун фильтра брендов ESP
    local espBrandDropdown = ESPGroup:AddDropdown("ESPBrandFilter", {
        Text = "Фильтр брендов",
        Tooltip = "Выберите бренды для подсветки.",
        Values = espAvailableBrands,
        Multi = true,
        Callback = function(selected)
            -- selected: { [brandName] = true/false }
            for _, brand in ipairs(espAvailableBrands) do
                local state = selected[brand]
                -- включён только если явно true; nil/false = выключен
                espBrandFilter[brand] = (state == true)
            end
        end
    })

    -- Изначально выбираем все бренды, чтобы ESP работал как раньше
    if espBrandDropdown and espBrandDropdown.SetValue then
        espBrandDropdown:SetValue(espAvailableBrands)
    end

    local function getPlayerBalance()
        local lp = game:GetService("Players").LocalPlayer
        if not lp then return 0 end
        local ls = lp:FindFirstChild("leaderstats")
        if not ls then return 0 end
        local rub = ls:FindFirstChild("Рубли") or ls:FindFirstChild("Rubles") or ls:FindFirstChild("Money")
        local v = rub and rub.Value
        if typeof(v) == "number" then return v end
        if typeof(v) == "string" then return tonumber((v:gsub("[^%d]",""))) or 0 end
        return 0
    end

    function ApplyESPStyle(espElements, style, richText)
        local highlight = espElements.highlight
        local billboardGui = espElements.billboardGui
        local backgroundFrame = billboardGui.Background
        local stroke = backgroundFrame:FindFirstChildOfClass("UIStroke") or Instance.new("UIStroke", backgroundFrame)
        local gradient = backgroundFrame:FindFirstChildOfClass("UIGradient") or Instance.new("UIGradient", backgroundFrame)
        local textLabel = backgroundFrame.InfoLabel
        local warnLabel = backgroundFrame:FindFirstChild("WarnLabel")
        local corner = backgroundFrame:FindFirstChildOfClass("UICorner") or Instance.new("UICorner", backgroundFrame)
        local glowStroke = backgroundFrame:FindFirstChild("Glow")
        if glowStroke then glowStroke:Destroy() end -- Remove old strokes

        -- Stop any previous animations
        if espElements.tween then
            espElements.tween:Cancel()
            espElements.tween = nil
        end
        if espElements.rainbowCoroutine then
            coroutine.close(espElements.rainbowCoroutine)
            espElements.rainbowCoroutine = nil
        end

        -- Universal properties (кроме стиля 3, где мы скрываем фрейм полностью)
        highlight.Enabled = espHighlightEnabled
        -- Для стиля 3 не включаем BillboardGui и не показываем фон
        if style ~= "3" then
            billboardGui.Enabled = true
            backgroundFrame.Visible = true
            -- Ensure consistent Billboard size even when reusing from pool
            espElements.billboardGui.Size = UDim2.new(0, 280, 0, 64)
        else
            billboardGui.Enabled = false
            backgroundFrame.Visible = false
        end

        textLabel.Text = richText
        textLabel.TextYAlignment = Enum.TextYAlignment.Center
        textLabel.TextXAlignment = Enum.TextXAlignment.Center
        textLabel.TextWrapped = true
        textLabel.TextStrokeColor3 = Color3.fromRGB(0,0,0)
        textLabel.TextStrokeTransparency = 0.7 -- default stroke for readability
        
        -- 1. Setup Warning Label state first, as it affects main label's size
        if warnLabel then
            warnLabel.Visible = espElements.nearThreshold and true or false
            warnLabel.Text = espElements.warnText or ""
        end

        -- 2. Set dynamic sizes based on warning visibility
        local textLabelAvailableHeight
        if warnLabel and warnLabel.Visible then
            textLabel.Size = UDim2.new(1, -12, 1, -30)
            textLabelAvailableHeight = 34
        else
                textLabel.Size = UDim2.new(1, -12, 1, -12)
            textLabelAvailableHeight = 52
        end

        -- 3. Auto-scale font size to fit available height
        local TextService = game:GetService("TextService")
        local function stripTags(s)
            return (tostring(s or ""):gsub("<.->", ""))
        end
        local maxWidth = 280 - 12

        local base = stripTags(textLabel.Text)
        local size = 14 -- Start with default size
        while size > 8 do -- Minimum font size of 9
            local bounds = TextService:GetTextSize(base, size, textLabel.Font, Vector2.new(maxWidth, math.huge))
            if bounds.Y <= textLabelAvailableHeight then
                break -- This font size fits
            end
            size = size - 1 -- Try smaller font
        end
        textLabel.TextSize = size

        -- 4. Set static positions
        textLabel.Position = UDim2.new(0, 6, 0, 6)
        warnLabel.Position = UDim2.new(0, 6, 1, -24)
        warnLabel.Size = UDim2.new(1, -12, 0, 18)

        if style == "1" then -- Default (Sleek)
            -- ensure richtext rendering is enabled for formatted content
            textLabel.RichText = true
            stroke.Enabled = true
            -- Highlight: slightly brighter, crisp outline
            highlight.FillColor = Color3.fromRGB(20, 255, 110)
            highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
            highlight.FillTransparency = 0.55
            highlight.OutlineTransparency = 0.08

            -- Card styling
            backgroundFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
            backgroundFrame.BackgroundTransparency = 0.08
            stroke.Enabled = true
            stroke.Color = Color3.fromRGB(30, 255, 120)
            stroke.Thickness = 1.6
            gradient.Enabled = true
            gradient.Rotation = 90
            gradient.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, Color3.fromRGB(54, 54, 54)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(26, 26, 26))
            })
            corner.CornerRadius = UDim.new(0, 10)

            -- Text styling + subtle emoji accents
            textLabel.Font = Enum.Font.SourceSans
            textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
            textLabel.TextStrokeTransparency = 0.65

                        textLabel.Text = richText
        elseif style == "2" then -- Old BETA style: Box + simple green text
            -- Disable background visuals and gradients
            gradient.Enabled = false
            stroke.Enabled = false
            backgroundFrame.BackgroundTransparency = 1
            corner.CornerRadius = UDim.new(0, 0)
            if warnLabel then warnLabel.Visible = false end
            
            -- Explicitly disable highlight for style 2 (box + text only)
            highlight.Enabled = false
            highlight.FillTransparency = 1
            highlight.OutlineTransparency = 1
            
            -- Configure billboard like in BETA
            local adornee = billboardGui.Adornee
            billboardGui.Enabled = true
            billboardGui.Size = UDim2.new(0, 250, 0, 60)
            if adornee and adornee:IsA("BasePart") then
                billboardGui.StudsOffset = Vector3.new(0, adornee.Size.Y / 2 + 1.2, 0)
            end
            billboardGui.MaxDistance = math.huge
            
            -- Configure text: green, bold, scaled, no richtext
            textLabel.RichText = false
            textLabel.Font = Enum.Font.SourceSansBold
            textLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
            textLabel.TextStrokeTransparency = 1
            textLabel.TextScaled = true
            textLabel.TextWrapped = true
            textLabel.TextXAlignment = Enum.TextXAlignment.Center
            textLabel.TextYAlignment = Enum.TextYAlignment.Center
            textLabel.Text = (tostring(richText or ""):gsub("<.->", ""))
            
            -- Add/update BoxHandleAdornment around the part
            if adornee and adornee:IsA("BasePart") then
                if espElements.box and espElements.box.Parent then
                    espElements.box.Adornee = adornee
                    espElements.box.Size = adornee.Size + Vector3.new(0.2, 0.2, 0.2)
                    espElements.box.Color3 = Color3.fromRGB(0, 255, 0)
                    espElements.box.Transparency = 0.5
                    espElements.box.AlwaysOnTop = true
                    espElements.box.ZIndex = 1
                else
                    local box = Instance.new("BoxHandleAdornment")
                    box.Name = "PayOffBox"
                    box.Adornee = adornee
                    box.Size = adornee.Size + Vector3.new(0.2, 0.2, 0.2)
                    box.Color3 = Color3.fromRGB(0, 255, 0)
                    box.Transparency = 0.5
                    box.AlwaysOnTop = true
                    box.ZIndex = 1
                    box.Parent = adornee
                    espElements.box = box
                end
            end
        elseif style == "3" then -- Highlight only: no frames/text
            -- Hide billboard/text and remove box if exists
            billboardGui.Enabled = false
            backgroundFrame.Visible = false
            if espElements.box then pcall(function() espElements.box:Destroy() end); espElements.box = nil end
            -- Only highlight
            highlight.FillColor = Color3.fromRGB(30, 255, 120)
            highlight.FillTransparency = 0.5
            highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
            highlight.OutlineTransparency = 0.1
        end

        -- Fit main text inside fixed frame by wrapping and downscaling font if needed
        local TextService = game:GetService("TextService")
        local function stripTags(s)
            return (tostring(s or ""):gsub("<.->", ""))
        end
        local maxWidth = espElements.billboardGui.Size.X.Offset - 12
        local reserved = (warnLabel and warnLabel.Visible) and 22 or 0
        local maxHeight = espElements.billboardGui.Size.Y.Offset - 12 - reserved
        textLabel.TextWrapped = true
        textLabel.TextTruncate = Enum.TextTruncate.None
        local base = stripTags(textLabel.Text)
        local size = 14
        while size > 10 do
            local bounds = TextService:GetTextSize(base, size, textLabel.Font, Vector2.new(maxWidth, 1e6))
            if bounds.Y <= maxHeight then break end
            size = size - 1
        end
        textLabel.TextSize = size
        backgroundFrame.Size = UDim2.new(1, 0, 1, 0)
    end

function GetOrCreateESPElements(clothPart)
    local espElements
    
    if #espPool > 0 then
        espElements = table.remove(espPool)
        espElements.highlight.Enabled = true
        -- Не включаем BillboardGui заранее, стиль решит сам (особенно важно для стиля 3)
        espElements.billboardGui.Enabled = (espStyle ~= "3")
    else
            -- Create raw instances without specific styling
        local highlight = Instance.new("Highlight")
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        
        local billboardGui = Instance.new("BillboardGui")
        billboardGui.Size = UDim2.new(0, 260, 0, 54)
        billboardGui.AlwaysOnTop = true
        
        local backgroundFrame = Instance.new("Frame", billboardGui)
        backgroundFrame.Name = "Background"
        backgroundFrame.Size = UDim2.new(1, 0, 1, 0)
        backgroundFrame.ClipsDescendants = true

        local pad = Instance.new("UIPadding", backgroundFrame)
        pad.PaddingTop = UDim.new(0, 6)
        pad.PaddingBottom = UDim.new(0, 6)
        pad.PaddingLeft = UDim.new(0, 6)
        pad.PaddingRight = UDim.new(0, 6)

            local gradient = Instance.new("UIGradient", backgroundFrame)
        gradient.Rotation = 90
            
            Instance.new("UICorner", backgroundFrame).CornerRadius = UDim.new(0, 8)
            local stroke = Instance.new("UIStroke", backgroundFrame)
        stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

        local textLabel = Instance.new("TextLabel", backgroundFrame)
        textLabel.Name = "InfoLabel"
        textLabel.Size = UDim2.new(1, -12, 1, -12)
        textLabel.Position = UDim2.new(0, 6, 0, 6)
        textLabel.AnchorPoint = Vector2.new(0, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            textLabel.TextScaled = true
        textLabel.Font = Enum.Font.SourceSans
        textLabel.RichText = true
            textLabel.TextXAlignment = Enum.TextXAlignment.Center
            textLabel.TextYAlignment = Enum.TextYAlignment.Center
        textLabel.TextWrapped = true
        textLabel.TextStrokeColor3 = Color3.fromRGB(0,0,0)
        textLabel.TextStrokeTransparency = 0.7

        -- Bottom warning label (hidden by default)
        local warnLabel = Instance.new("TextLabel", backgroundFrame)
        warnLabel.Name = "WarnLabel"
        warnLabel.BackgroundTransparency = 1
        warnLabel.RichText = true
            warnLabel.TextXAlignment = Enum.TextXAlignment.Center
        warnLabel.TextYAlignment = Enum.TextYAlignment.Center
            warnLabel.TextScaled = true
        warnLabel.Size = UDim2.new(1, -12, 0, 18)
        warnLabel.Position = UDim2.new(0, 6, 1, -30)
        warnLabel.Visible = false

        billboardGui.Parent = game:GetService("CoreGui")
        
        espElements = { billboardGui = billboardGui, highlight = highlight }
    end

        -- Fade-in animation (только для стилей с фреймом)
        if espStyle ~= "3" then
            espElements.billboardGui.Background.BackgroundTransparency = 1
            TweenService:Create(espElements.billboardGui.Background, TweenInfo.new(0.3), { BackgroundTransparency = 0.1 }):Play()
        end

    espElements.highlight.Adornee = clothPart
    espElements.highlight.Parent = clothPart
    espElements.billboardGui.Adornee = clothPart
        espElements.billboardGui.MaxDistance = espMaxDistance -- Keep this updated
    espElements.billboardGui.StudsOffset = Vector3.new(0, clothPart.Size.Y / 2 + 1.5, 0)
    
    return espElements
end

function ReturnESPElementsToPool(espData)
        if espData.tween then
            espData.tween:Cancel()
            espData.tween = nil
        end
        if espData.rainbowCoroutine then
            coroutine.close(espData.rainbowCoroutine)
            espData.rainbowCoroutine = nil
        end
    if espData.billboardGui and espData.billboardGui.Parent then
            local oldOffset = espData.billboardGui.Background:FindFirstChildOfClass("NumberValue")
            if oldOffset then oldOffset:Destroy() end
        espData.billboardGui.Enabled = false
        espData.billboardGui.Adornee = nil
    end
    if espData.highlight and espData.highlight.Parent then
        espData.highlight.Enabled = false
        espData.highlight.Adornee = nil
        espData.highlight.Parent = nil
    end
    espPool[#espPool + 1] = espData
end

function ClearAllPayOffESP()
    for part, espData in pairs(activeESPCache) do
        ReturnESPElementsToPool(espData)
    end
    activeESPCache = {}
end

function UpdatePayOffESP()
        if not Toggles.EnableESPCClothes or not Toggles.EnableESPCClothes.Value then return end

    local worldFolder = game.Workspace:FindFirstChild("World")
    if not worldFolder then return end

    local seenThisUpdate = {}

    local hrp = lp.Character and lp.Character:FindFirstChild("HumanoidRootPart")
    for i, storeItemModel in ipairs(worldFolder:GetDescendants()) do
        if storeItemModel:IsA("Model") and storeItemModel:FindFirstChild("Clothing") then
            local clothingPart = storeItemModel.Clothing
            local prompt = storeItemModel:FindFirstChildOfClass("ProximityPrompt")

            if clothingPart and prompt and prompt.Enabled and prompt.ActionText ~= "Повесить" and prompt.MaxActivationDistance > 0 then
                local clothName = prompt.ObjectText
                local currentPriceText = string.gsub(prompt.ActionText, "%D+", "") 
                local skip = false

                    
                -- Distance optimization (skip far items before heavy work)
                if not skip and hrp and (hrp.Position - clothingPart.Position).Magnitude > (espMaxDistance + 20) then
                    skip = true
                end
                
                if not skip and clothName and currentPriceText and currentPriceText ~= "" then
                    local currentPrice = tonumber(currentPriceText)
                    local itemShouldHaveESP = false
                    local richEspText = ""

                    local nearThreshold, warnText = false, nil

                    -- нормализованный поиск по имени, чтобы игнорировать регистр, ё/е и лишние пробелы
                    local normName = normalizeName(clothName)
                    local payOffPrice = masterPriceTable[clothName] or normalizedPriceIndex[normName]
                    if payOffPrice then
                        if currentPrice and payOffPrice and currentPrice <= payOffPrice then
                            itemShouldHaveESP = true
                            richEspText = string.format('<font face="SourceSansSemibold" size="18" color="rgb(255,255,255)">%s</font>\n<font color="rgb(30, 255, 120)" size="16">Цена: %s ₽</font>', clothName, tostring(currentPrice))
                            nearThreshold, warnText = false, nil
                        end
                    end

                    if not itemShouldHaveESP then
                        for _, rule in ipairs(generalBrandRules) do
                            if string.find(string.lower(clothName), string.lower(rule.keyword), 1, true) then
                                if rule.alwaysPick or (currentPrice and currentPrice <= rule.maxPrice) then
                                    itemShouldHaveESP = true
                                    richEspText = string.format('<font face="SourceSansSemibold" size="18" color="rgb(255,255,255)">%s</font>\n<font color="rgb(30, 255, 120)" size="16">Цена: %s ₽</font>', clothName, tostring(currentPrice))
                                    break 
                                end
                            end
                        end
                    end
                    
                    -- Фильтр по брендам: если у вещи есть бренд и он отключён в фильтре, не подсвечиваем
                    local brand = itemBrandIndex[clothName] or normalizedBrandIndex[normalizeName(clothName)]
                    if brand and espBrandFilter[brand] == false then
                        itemShouldHaveESP = false
                    end

                    -- Фильтр по балансу: показывать только то, что можно купить
                    if espBalanceFilterEnabled and currentPrice then
                        local balance = getPlayerBalance()
                        if currentPrice > balance then
                            itemShouldHaveESP = false
                        end
                    end

                    if itemShouldHaveESP then
                       seenThisUpdate[clothingPart] = true
                       local cachedESP = activeESPCache[clothingPart]

                           if not cachedESP then
                               cachedESP = GetOrCreateESPElements(clothingPart)
                               activeESPCache[clothingPart] = cachedESP
                           end
                           -- apply near-threshold flags for this cycle
                           cachedESP.nearThreshold = nearThreshold or false
                           cachedESP.warnText = warnText
                           
                           -- Apply style only when content/style changed
                           if cachedESP.lastText ~= richEspText or cachedESP.lastStyle ~= espStyle then
                               ApplyESPStyle(cachedESP, espStyle, richEspText)
                               cachedESP.lastText = richEspText
                               cachedESP.lastStyle = espStyle
                           end
                    end
                end
            end
        end
    end
    
    for part, espData in pairs(activeESPCache) do
        if not seenThisUpdate[part] or not part.Parent then
            ReturnESPElementsToPool(espData)
            activeESPCache[part] = nil
        end
    end
end
    
    ESPGroup:AddToggle("EnableESPCClothes", {
        Text = "Окупная одежда ESP",
        Tooltip = "Подсвечивает выгодную одежду.",
        Default = espPayOffClothesEnabled,
    Callback = function(Value)
        espPayOffClothesEnabled = Value
        if espPayOffClothesEnabled then
                Library:Notify({Title = "ESP", Description = "Включено", Time = 2})
            if not espPayOffUpdateLoopActive then
                espPayOffUpdateLoopActive = true
                task.spawn(function()
                    while espPayOffClothesEnabled and espPayOffUpdateLoopActive do
                        UpdatePayOffESP()
                            task.wait(espUpdateFrequency)
                    end
                    espPayOffUpdateLoopActive = false
                end)
            end
        else
                Library:Notify({Title = "ESP", Description = "Выключено", Time = 2})
            espPayOffUpdateLoopActive = false
            ClearAllPayOffESP()
        end
    end,
})

    ESPGroup:AddCheckbox("ESPBalanceFilter", {
        Text = "Балансный фильтр",
        Tooltip = "Показывает только то, что вы можете купить.",
        Default = espBalanceFilterEnabled,
    })
    Toggles.ESPBalanceFilter:OnChanged(function(state)
        espBalanceFilterEnabled = state
        ClearAllPayOffESP()
        task.defer(function()
            if UpdatePayOffESP then UpdatePayOffESP() end
            if UpdateESPPayOffClothes then UpdateESPPayOffClothes() end
        end)
    end)

    ESPGroup:AddCheckbox("ESPClothesHighlight", {
        Text = "Подсветка предметов",
        Tooltip = "Показывает подсветку у одежды с ESP.",
        Default = espHighlightEnabled,
    })
    Toggles.ESPClothesHighlight:OnChanged(function(state)
        espHighlightEnabled = state
        ClearAllPayOffESP()
        task.defer(function()
            if UpdatePayOffESP then UpdatePayOffESP() end
            if UpdateESPPayOffClothes then UpdateESPPayOffClothes() end
        end)
    end)

    ESPGroup:AddDropdown("ESPStyle", {
        Text = "Стиль ESP",
        Tooltip = "Меняет внешний вид ESP.",
        Values = {"1","2","3"},
        Default = espStyle,
        Callback = function(value)
            espStyle = value
            -- Force refresh of existing ESP so the new style applies immediately
            ClearAllPayOffESP()
            task.defer(function()
                UpdatePayOffESP()
            end)
        end
    })

    ESPGroup:AddSlider("ESPUpdateFrequency", {
        Text = "Частота обновления ESP (сек)",
        Tooltip = "Меняет частоту обновления ESP.",
        Min = 0.1, Max = 2.0, Default = espUpdateFrequency,
        Rounding = 1,
        Callback = function(value) espUpdateFrequency = value end
    })

    ESPGroup:AddSlider("ESPMaxDistance", {
        Text = "Максимальная дистанция ESP (студов)",
        Tooltip = "Меняет дистанцию отображения ESP.",
        Min = 20, Max = 200, Default = espMaxDistance,
        Rounding = 0,
        Callback = function(value)
            espMaxDistance = value
            for _, espData in pairs(activeESPCache) do
                if espData.billboardGui then
                    espData.billboardGui.MaxDistance = value
                end
            end
        end,
    })

--#endregion ESP Clothes Tab

--#region ESP Players Tab
do
    local ESPPlayersGroup = Tabs.ESPPlayers:AddLeftGroupbox("ESP Игроков")
    local playersESPEnabled = false
    local showHighlight = true
    local nameplates = {}

    -- настройки ESP для игроков
    local espPlayerMaxDistance = 200
    local espWallCheckEnabled = false
    local espFriendCheckEnabled = false
    local espFriendsOnly = false
    local espVerifiedOnly = false

    local Verified = {
        [1026572358] = true,
        [1123486805] = true,
        [1186779340] = true,
        [1279868559] = true,
        [1327472506] = true,
        [1453873501] = true,
        [1504861667] = true,
        [1600339295] = true,
        [170102043] = true,
        [1753812345] = true,
        [189082896] = true,
        [2062246620] = true,
        [2638155716] = true,
        [2653922296] = true,
        [2680486757] = true,
        [2999558653] = true,
        [304833543] = true,
        [3146401689] = true,
        [3473981925] = true,
        [3669952944] = true,
        [3770586330] = true,
        [390673217] = true,
        [3918366821] = true,
        [3924245599] = true,
        [398312574] = true,
        [399939444] = true,
        [407279387] = true,
        [4395852780] = true,
        [450402311] = true,
        [459924542] = true,
        [4727589710] = true,
        [4865580845] = true,
        [540251784] = true,
        [559100549] = true,
        [5637757272] = true,
        [578504645] = true,
        [6042963013] = true,
        [6163435775] = true,
        [621887518] = true,
        [647616748] = true,
        [76161052] = true,
        [7900677920] = true,
        [818586739] = true,
        [858379732] = true,
        [883757489] = true,
    }

    local function getRubles(p)
        local ls = p:FindFirstChild("leaderstats") or p:FindFirstChildWhichIsA("Folder")
        local r = ls and ls:FindFirstChild("Рубли")
        local ok, val = pcall(function() return r and r.Value or nil end)
        return ok and val or nil
    end

    local function createNameplate(character)
        if not character then return end
        local head = character:FindFirstChild("Head")
        if not head then return end

        local bb = Instance.new("BillboardGui")
        bb.Name = "VexusPlayerPlate"
        bb.AlwaysOnTop = true
        bb.Size = UDim2.new(0, 140, 0, 32)
        bb.StudsOffset = Vector3.new(0, 2.4, 0)
        bb.Adornee = head

        local frame = Instance.new("Frame", bb)
        frame.Name = "Glass"
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
        frame.BackgroundTransparency = 0.1
        local corner = Instance.new("UICorner", frame)
        corner.CornerRadius = UDim.new(0, 8)
        local stroke = Instance.new("UIStroke", frame)
        stroke.Thickness = 1.2
        stroke.Color = Color3.fromRGB(30,255,120)
        stroke.Transparency = 0.1
        local grad = Instance.new("UIGradient", frame)
        grad.Color = ColorSequence.new({ ColorSequenceKeypoint.new(0, Color3.fromRGB(50,50,50)), ColorSequenceKeypoint.new(1, Color3.fromRGB(25,25,25)) })
        grad.Rotation = 90

        local label = Instance.new("TextLabel", frame)
        label.Name = "Txt"
        label.BackgroundTransparency = 1
        label.Size = UDim2.new(1, -8, 1, -6)
        label.Position = UDim2.fromOffset(4,3)
        label.TextXAlignment = Enum.TextXAlignment.Center
        label.TextYAlignment = Enum.TextYAlignment.Center
        label.Font = Enum.Font.SourceSans
        label.TextSize = 13
        label.RichText = true
        label.TextColor3 = Color3.fromRGB(255,255,255)

        local hl = Instance.new("Highlight")
        hl.Enabled = showHighlight
        hl.Adornee = character
        hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        hl.OutlineColor = Color3.fromRGB(255,255,255)
        hl.FillColor = Color3.fromRGB(10,255,80)
        hl.FillTransparency = 0.6
        hl.OutlineTransparency = 0.1
        hl.Parent = character

        nameplates[character] = { bb = bb, label = label, hl = hl }
        bb.Parent = game:GetService("CoreGui")
    end

    local function destroyForCharacter(character)
        local rec = nameplates[character]
        if rec then
            if rec.bb then pcall(function() rec.bb:Destroy() end) end
            if rec.hl then pcall(function() rec.hl:Destroy() end) end
            nameplates[character] = nil
        end
    end

    local function updatePlates()
        if not playersESPEnabled then return end

        local hrp = lp.Character and lp.Character:FindFirstChild("HumanoidRootPart")
        local camera = workspace.CurrentCamera

        for _, pl in ipairs(game:GetService("Players"):GetPlayers()) do
            if pl ~= lp then
                local ch = pl.Character
                local head = ch and ch:FindFirstChild("Head")
                if ch and head then
                    local skip = false

                    -- friend / verified
                    local isFriend = false
                    pcall(function()
                        isFriend = lp:IsFriendsWith(pl.UserId)
                    end)
                    local isVerified = Verified[pl.UserId] == true

                    if espFriendsOnly and not isFriend then
                        if nameplates[ch] then destroyForCharacter(ch) end
                        skip = true
                    end

                    if not skip and espVerifiedOnly and not isVerified then
                        if nameplates[ch] then destroyForCharacter(ch) end
                        skip = true
                    end

                    -- distance
                    if not skip and hrp and espPlayerMaxDistance and espPlayerMaxDistance > 0 then
                        local dist = (head.Position - hrp.Position).Magnitude
                        if dist > espPlayerMaxDistance then
                            if nameplates[ch] then destroyForCharacter(ch) end
                            skip = true
                        end
                    end

                    -- wall check
                    if not skip and espWallCheckEnabled and camera and hrp then
                        local origin = camera.CFrame.Position
                        local direction = (head.Position - origin)
                        local params = RaycastParams.new()
                        params.FilterType = Enum.RaycastFilterType.Blacklist
                        params.FilterDescendantsInstances = {lp.Character, ch}
                        local result = workspace:Raycast(origin, direction, params)
                        if result and result.Instance and not ch:IsAncestorOf(result.Instance) then
                            if nameplates[ch] then destroyForCharacter(ch) end
                            skip = true
                        end
                    end

                    if not skip then
                        if not nameplates[ch] then
                            createNameplate(ch)
                        end

                        local rec = nameplates[ch]
                        if rec and rec.label then
                            local rub = getRubles(pl)
                            local function abbreviate(n)
                                if type(n) ~= "number" then return tostring(n or "—") end
                                local abs = math.abs(n)
                                if abs >= 1e12 then return string.format("%.2fT", n/1e12) end
                                if abs >= 1e9 then return string.format("%.2fB", n/1e9) end
                                if abs >= 1e6 then return string.format("%.2fM", n/1e6) end
                                if abs >= 1e3 then return string.format("%.1fK", n/1e3) end
                                return tostring(n)
                            end

                            local namePrefix = ""
                            if isVerified then
                                -- более заметный тег для верифицированных
                                namePrefix = namePrefix .. '[VERIFIED] '
                            end
                            if espFriendCheckEnabled and isFriend then
                                namePrefix = namePrefix .. "[FRIEND] "
                            end

                            rec.label.Text = string.format(
                                '<font face="SourceSansSemibold" size="18" color="rgb(255,255,255)">%s%s</font>\n' ..
                                '<font color="rgb(30, 255, 120)" size="16">%s ₽</font>',
                                namePrefix,
                                pl.Name,
                                abbreviate(tonumber(rub))
                            )
                        end

                        if rec and rec.hl then
                            rec.hl.Enabled = showHighlight
                        end
                    end
                end
            end
        end

        -- cleanup for removed characters
        for ch, _ in pairs(nameplates) do
            if not ch.Parent then destroyForCharacter(ch) end
        end
    end

    ESPPlayersGroup:AddToggle("EnableESPPlayers", {
        Text = "ESP игроков",
        Tooltip = "Показывает информацию над игроками.",
        Default = false,
        Callback = function(state)
            playersESPEnabled = state
            if not state then
                for ch,_ in pairs(nameplates) do destroyForCharacter(ch) end
            else
                task.spawn(function()
                    while playersESPEnabled do
                        updatePlates()
                        task.wait(0.5)
                    end
                end)
            end
        end
    })

    ESPPlayersGroup:AddCheckbox("ESPPlayerHighlight", {
        Text = "Подсветка контура",
        Tooltip = "Показывает контур у игроков.",
        Default = true,
    })
    Toggles.ESPPlayerHighlight:OnChanged(function(state)
        showHighlight = state
    end)

    ESPPlayersGroup:AddSlider("ESPPlayerDistance", {
        Text = "Дистанция ESP (студов)",
        Tooltip = "Максимальная дистанция отображения ESP по игрокам.",
        Min = 20,
        Max = 1000,
        Default = espPlayerMaxDistance,
        Rounding = 0,
        Callback = function(v)
            espPlayerMaxDistance = v
        end
    })

    ESPPlayersGroup:AddCheckbox("ESPPlayerWallCheck", {
        Text = "Проверка стен",
        Tooltip = "Скрывает ESP через стены.",
        Default = espWallCheckEnabled,
    })
    Toggles.ESPPlayerWallCheck:OnChanged(function(state)
        espWallCheckEnabled = state
    end)

    ESPPlayersGroup:AddCheckbox("ESPPlayerFriendCheck", {
        Text = "Тег друзей",
        Tooltip = "Помечает друзей в ESP.",
        Default = espFriendCheckEnabled,
    })
    Toggles.ESPPlayerFriendCheck:OnChanged(function(state)
        espFriendCheckEnabled = state
    end)

    ESPPlayersGroup:AddCheckbox("ESPPlayerFriendsOnly", {
        Text = "Только друзья",
        Tooltip = "Показывает ESP только на друзьях.",
        Default = espFriendsOnly,
    })
    Toggles.ESPPlayerFriendsOnly:OnChanged(function(state)
        espFriendsOnly = state
    end)

    ESPPlayersGroup:AddCheckbox("ESPPlayerVerifiedOnly", {
        Text = "Только проверенные",
        Tooltip = "Показывает ESP только на проверенных игроках.",
        Default = espVerifiedOnly,
    })
    Toggles.ESPPlayerVerifiedOnly:OnChanged(function(state)
        espVerifiedOnly = state
    end)
end
--#endregion ESP Players Tab

--#region ESP Dropped Clothes Tab
do
    local ESPDroppedGroup = Tabs.ESPDropped:AddLeftGroupbox("ESP: Выброшенные вещи")

    ESPDroppedGroup:AddLabel("ESP выброшенной одежды", "Подсвечивает выброшенную одежду в мире.\n• Источник: workspace.World.Debris\n• Использует тот же стиль рамки, что и ESP окупной одежды")

    local droppedESPEnabled = false
    local droppedESPLoopActive = false
    local droppedESPCache = {}
    local droppedMaxDistance = 1000
    local droppedOutlineEnabled = true
    local droppedIgnoreList = {
        ["abbf5b75c265ff887f1febaaa6b4dccb"] = true,
        ["a9df8b2a08cb9f1bbe9b3b052bae672a"] = true,
        ["ddd"] = true,
        ["MetroDoors"] = true
    }

    local function ClearAllDroppedESP()
        for obj, espData in pairs(droppedESPCache) do
            ReturnESPElementsToPool(espData)
            droppedESPCache[obj] = nil
        end
    end

    local function UpdateDroppedESP()
        if not droppedESPEnabled then return end

        local world = workspace:FindFirstChild("World")
        local debris = world and world:FindFirstChild("Debris") or nil
        if not debris then return end

        local hrp = lp.Character and lp.Character:FindFirstChild("HumanoidRootPart")

        local seenThisUpdate = {}

        for _, m in ipairs(debris:GetChildren()) do
            if m:IsA("Model") and not droppedIgnoreList[m.Name] then
                local clothingPart = m:FindFirstChild("Clothing") or m:FindFirstChildWhichIsA("BasePart", true)
                local prompt = nil
                if clothingPart then
                    prompt = m:FindFirstChildOfClass("ProximityPrompt") or clothingPart:FindFirstChildOfClass("ProximityPrompt")
                end

                local skip = false

                if clothingPart and prompt and prompt.Enabled then
                    -- фильтр по дистанции
                    if hrp and droppedMaxDistance and droppedMaxDistance > 0 then
                        local dist = (clothingPart.Position - hrp.Position).Magnitude
                        if dist > droppedMaxDistance then
                            skip = true
                        end
                    end

                    if not skip then
                        local clothName = (prompt.ActionText and prompt.ActionText ~= "") and prompt.ActionText or (prompt.ObjectText or m.Name)
                        local richText = string.format(
                            '<font face="SourceSansSemibold" size="18" color="rgb(255,255,255)">%s</font>\n' ..
                            '<font color="rgb(255, 230, 150)" size="16">Выброшенный предмет</font>',
                            clothName
                        )

                        seenThisUpdate[m] = true

                        local espData = droppedESPCache[m]
                        if not espData then
                            espData = GetOrCreateESPElements(clothingPart)
                            droppedESPCache[m] = espData
                        end

                        -- Применяем текущий стиль ESP
                        if espData.lastText ~= richText or espData.lastStyle ~= espStyle then
                            ApplyESPStyle(espData, espStyle, richText)
                            espData.lastText = richText
                            espData.lastStyle = espStyle
                        end

                        -- управление обводкой для дропа отдельно
                        if espData.highlight then
                            espData.highlight.Enabled = droppedOutlineEnabled
                        end
                    end
                end
            end
        end

        -- очистка для удалённых объектов или тех, что не были замечены в этом апдейте
        for obj, espData in pairs(droppedESPCache) do
            if (not seenThisUpdate[obj]) or (not obj.Parent) then
                ReturnESPElementsToPool(espData)
                droppedESPCache[obj] = nil
            end
        end
    end

    ESPDroppedGroup:AddToggle("EnableESPDropped", {
        Text = "ESP выброшенной одежды",
        Tooltip = "Подсвечивает выброшенную одежду.",
        Default = droppedESPEnabled,
        Callback = function(v)
            droppedESPEnabled = v
            if droppedESPEnabled then
                if not droppedESPLoopActive then
                    droppedESPLoopActive = true
                    task.spawn(function()
                        while droppedESPEnabled do
                            UpdateDroppedESP()
                            task.wait(espUpdateFrequency)
                        end
                        droppedESPLoopActive = false
                    end)
                end
            else
                droppedESPLoopActive = false
                ClearAllDroppedESP()
            end
        end
    })

    ESPDroppedGroup:AddSlider("ESPDroppedDistance", {
        Text = "Дистанция ESP",
        Tooltip = "Меняет дистанцию отображения ESP.",
        Min = 20,
        Max = 1000,
        Default = droppedMaxDistance,
        Rounding = 0,
        Callback = function(v)
            droppedMaxDistance = v
        end
    })

    ESPDroppedGroup:AddCheckbox("ESPDroppedOutline", {
        Text = "Обводка",
        Tooltip = "Показывает обводку у выброшенной одежды.",
        Default = droppedOutlineEnabled,
    })
    Toggles.ESPDroppedOutline:OnChanged(function(state)
        droppedOutlineEnabled = state
    end)
end
--#endregion ESP Dropped Clothes Tab

--#region Player Tab
do
    local ServerGroup = Tabs.Player:AddLeftGroupbox("Серверные действия")

    ServerGroup:AddButton({
        Text = "Перезайти",
        Tooltip = "Перезайти на этот же сервер.",
        Func = function()
        local teleportService = game:GetService("TeleportService")
            teleportService:Teleport(game.PlaceId, lp)
    end,
})

    ServerGroup:AddButton({
        Text = "Сменить сервер",
        Tooltip = "Найти и телепортироваться на другой, менее заполненный сервер.",
        Func = function()
        local serversUrl = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"
            Library:Notify({Title = "Сервер", Description = "Ищу сервер...", Time = 3})
        local ok, response = pcall(game.HttpGet, game, serversUrl)
            if not ok then Library:Notify({Title = "Сервер", Description = "Ошибка запроса", Time = 4}); return end
        local ok2, servers = pcall(HttpService.JSONDecode, HttpService, response)
            if not ok2 or not servers or not servers.data then Library:Notify({Title = "Сервер", Description = "Ошибка разбора", Time = 4}); return end
        local candidates = {}
        for _, s in ipairs(servers.data) do
            if s.id ~= game.JobId and s.playing < s.maxPlayers then candidates[#candidates + 1] = s.id end
        end
            if #candidates == 0 then Library:Notify({Title = "Сервер", Description = "Нет доступных серверов.", Time = 4}); return end
        local target = candidates[math.random(1, #candidates)]
            Library:Notify({Title = "Сервер", Description = "Телепортирую...", Time = 3})
        game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, target, lp)
    end,
})

    -- Teleport to Biggest Server (most players but not full)
    ServerGroup:AddButton({
        Text = "Самый заполненный сервер",
        Tooltip = "Подключиться к самому заполненному доступному серверу.",
        Func = function()
            local url = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Desc&limit=100"
            Library:Notify({Title = "Сервер", Description = "Получаю список...", Time = 3})
            local ok, resp = pcall(game.HttpGet, game, url)
            if not ok then Library:Notify({Title = "Сервер", Description = "Ошибка запроса", Time = 4}); return end
            local ok2, data = pcall(HttpService.JSONDecode, HttpService, resp)
            if not ok2 or not data or not data.data then Library:Notify({Title = "Сервер", Description = "Ошибка разбора", Time = 4}); return end
            local best
            local bestCount = -1
            for _, s in ipairs(data.data) do
                if s.id ~= game.JobId and s.playing < s.maxPlayers and s.playing > bestCount then
                    best = s.id; bestCount = s.playing
                end
            end
            if best then
                Library:Notify({Title = "Сервер", Description = "Телепортирую...", Time = 3})
                game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, best, lp)
            else
                Library:Notify({Title = "Сервер", Description = "Нет подходящих серверов.", Time = 4})
            end
        end
    })

    -- Teleport to Smallest Server (fewest players but non-empty preferred, fallback empty)
    ServerGroup:AddButton({
        Text = "Самый пустой сервер",
        Tooltip = "Подключиться к наименее заполненному серверу.",
        Func = function()
            local url = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"
            Library:Notify({Title = "Сервер", Description = "Получаю список...", Time = 3})
            local ok, resp = pcall(game.HttpGet, game, url)
            if not ok then Library:Notify({Title = "Сервер", Description = "Ошибка запроса", Time = 4}); return end
            local ok2, data = pcall(HttpService.JSONDecode, HttpService, resp)
            if not ok2 or not data or not data.data then Library:Notify({Title = "Сервер", Description = "Ошибка разбора", Time = 4}); return end
            local best
            local bestCount = math.huge
            for _, s in ipairs(data.data) do
                if s.id ~= game.JobId and s.playing < s.maxPlayers and s.playing < bestCount then
                    best = s.id; bestCount = s.playing
                end
            end
            if best then
                Library:Notify({Title = "Сервер", Description = "Телепортирую...", Time = 3})
                game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, best, lp)
            else
                Library:Notify({Title = "Сервер", Description = "Нет подходящих серверов.", Time = 4})
            end
        end
    })
end
--#endregion Player Tab
do
    local MiscGroup = Tabs.Misc:AddLeftGroupbox("Клиентские настройки")
    MiscGroup:AddInput("FakeRubliInput", {
        Text = " Фейковые рубли",
        Tooltip = "Изменяет отображаемое количество рублей (только для вас).",
        Placeholder = "Введите сумму",
        Numeric = true,
        Finished = true,
        Callback = function(text)
            local amount = tonumber(text)
            if amount == nil then
                return
            end

            local leaderstats = lp and lp:FindFirstChild("leaderstats")
            local rubleStat = leaderstats and leaderstats:FindFirstChild("Рубли")
            if rubleStat then
                rubleStat.Value = amount
                Library:Notify({ Title = "Разное", Description = "Отображаемые рубли: " .. amount, Time = 3 })
            end
        end
    })

    -- Noclip (проход сквозь объекты)
    local noclipEnabled = false
    local noclipConnection

    MiscGroup:AddToggle("NoclipToggle", {
        Text = "Ноклип",
        Tooltip = "Позволяет проходить сквозь объекты (только клиент).",
        Default = false,
        Callback = function(value)
            noclipEnabled = value

            if noclipEnabled then
                if noclipConnection then noclipConnection:Disconnect() end
                noclipConnection = RunService.Stepped:Connect(function()
                    local character = lp.Character
                    if not character then return end
                    for _, part in ipairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end)
            else
                if noclipConnection then
                    noclipConnection:Disconnect()
                    noclipConnection = nil
                end
                local character = lp and lp.Character
                if character then
                    for _, part in ipairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = true
                        end
                    end
                end
            end
        end
    })

    local antiLagEnabled = false
    local antiLagState = {
        lighting = {},
        effects = {},
        emitters = {},
        lights = {},
    }

    local function setDescendantsEnabled(className, enabled, bucket)
        for _, inst in ipairs(game:GetDescendants()) do
            if inst.ClassName == className then
                if bucket then
                    bucket[inst] = inst.Enabled
                end
                pcall(function() inst.Enabled = enabled end)
            end
        end
    end

    local function setLightingProp(prop, value)
        local lighting = game:GetService("Lighting")
        if antiLagState.lighting[prop] == nil then
            pcall(function() antiLagState.lighting[prop] = lighting[prop] end)
        end
        pcall(function() lighting[prop] = value end)
    end

    local function applyAntiLag(on)
        local lighting = game:GetService("Lighting")
        local terrain = workspace:FindFirstChildOfClass("Terrain")

        if on then
            setLightingProp("GlobalShadows", false)
            setLightingProp("FogEnd", 1000000)
            setLightingProp("Brightness", 1)

            for _, eff in ipairs(lighting:GetChildren()) do
                if eff:IsA("PostEffect") then
                    antiLagState.effects[eff] = eff.Enabled
                    pcall(function() eff.Enabled = false end)
                end
            end

            setDescendantsEnabled("ParticleEmitter", false, antiLagState.emitters)
            setDescendantsEnabled("Trail", false, antiLagState.emitters)
            setDescendantsEnabled("Beam", false, antiLagState.emitters)

            for _, inst in ipairs(game:GetDescendants()) do
                if inst:IsA("PointLight") or inst:IsA("SpotLight") or inst:IsA("SurfaceLight") then
                    antiLagState.lights[inst] = inst.Enabled
                    pcall(function() inst.Enabled = false end)
                end
            end

            if terrain then
                pcall(function()
                    if antiLagState.lighting.__WaterWaveSize == nil then antiLagState.lighting.__WaterWaveSize = terrain.WaterWaveSize end
                    if antiLagState.lighting.__WaterWaveSpeed == nil then antiLagState.lighting.__WaterWaveSpeed = terrain.WaterWaveSpeed end
                    if antiLagState.lighting.__WaterReflectance == nil then antiLagState.lighting.__WaterReflectance = terrain.WaterReflectance end
                    if antiLagState.lighting.__WaterTransparency == nil then antiLagState.lighting.__WaterTransparency = terrain.WaterTransparency end
                    terrain.WaterWaveSize = 0
                    terrain.WaterWaveSpeed = 0
                    terrain.WaterReflectance = 0
                    terrain.WaterTransparency = 1
                end)
            end
        else
            for prop, old in pairs(antiLagState.lighting) do
                if prop:sub(1,2) ~= "__" then
                    pcall(function() lighting[prop] = old end)
                end
            end

            for eff, oldEnabled in pairs(antiLagState.effects) do
                if eff and eff.Parent then
                    pcall(function() eff.Enabled = oldEnabled end)
                end
            end

            for inst, oldEnabled in pairs(antiLagState.emitters) do
                if inst and inst.Parent then
                    pcall(function() inst.Enabled = oldEnabled end)
                end
            end

            for inst, oldEnabled in pairs(antiLagState.lights) do
                if inst and inst.Parent then
                    pcall(function() inst.Enabled = oldEnabled end)
                end
            end

            if terrain then
                pcall(function()
                    if antiLagState.lighting.__WaterWaveSize ~= nil then terrain.WaterWaveSize = antiLagState.lighting.__WaterWaveSize end
                    if antiLagState.lighting.__WaterWaveSpeed ~= nil then terrain.WaterWaveSpeed = antiLagState.lighting.__WaterWaveSpeed end
                    if antiLagState.lighting.__WaterReflectance ~= nil then terrain.WaterReflectance = antiLagState.lighting.__WaterReflectance end
                    if antiLagState.lighting.__WaterTransparency ~= nil then terrain.WaterTransparency = antiLagState.lighting.__WaterTransparency end
                end)
            end

            antiLagState.effects = {}
            antiLagState.emitters = {}
            antiLagState.lights = {}
            antiLagState.lighting = {}
        end
    end

    MiscGroup:AddToggle("AntiLagToggle", {
        Text = "Анти лаги",
        Tooltip = "Отключает эффекты/частицы/свет для повышения FPS.",
        Default = false,
        Callback = function(v)
            antiLagEnabled = v
            applyAntiLag(antiLagEnabled)
            Library:Notify({ Title = "Анти лаги", Description = v and "Включено" or "Выключено", Time = 2 })
        end
    })

    MiscGroup:AddButton({
        Text = "Убрать ограничение FPS",
        Tooltip = "Снимает ограничение FPS.",
        Func = function()
            if setfpscap then
                pcall(function() setfpscap(0) end)
                Library:Notify({ Title = "FPS", Description = "Ограничение FPS снято", Time = 2 })
            else
                Library:Notify({ Title = "FPS", Description = "setfpscap недоступен", Time = 3 })
            end
        end
    })
    
    local infiniteJumpEnabled = false
    local infiniteJumpConn
    local UserInputService = game:GetService("UserInputService")

    MiscGroup:AddToggle("InfiniteJump", {
        Text = "Бесконечный прыжок",
        Tooltip = "Позволяет прыгать без ограничений.",
        Default = false,
        Callback = function(v)
            infiniteJumpEnabled = v
            if infiniteJumpConn then
                infiniteJumpConn:Disconnect()
                infiniteJumpConn = nil
            end
            if infiniteJumpEnabled then
                infiniteJumpConn = UserInputService.JumpRequest:Connect(function()
                    if not infiniteJumpEnabled then return end
                    local character = lp and lp.Character
                    local humanoid = character and character:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        pcall(function()
                            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                        end)
                    end
                end)
            end
        end
    })
end
--#endregion Misc Tab

--#region AutoBuy Tab

    local AutoBuyGroup = Tabs.AutoBuy:AddLeftGroupbox("Авто покупка")
    local autoBuyEnabled = false
    local autoBuyLoopActive = false
    local firePromptNotified = false
    local autoBuyDelay = 1 -- задержка между циклами Auto Buy

    local autoBuyOnlyPayOff = false
 
     local autoOplataEnabled = false
     local autoOplataLoopActive = false

 function UpdateAutoOplata()
     if not autoOplataEnabled then return end

     local character = lp.Character
     local humanRootPart = character and character:FindFirstChild("HumanoidRootPart")
     if not humanRootPart then return end

     local camera = workspace.CurrentCamera
     if not camera then return end

     local world = workspace:FindFirstChild("World")
     local debris = world and world:FindFirstChild("Debris") or nil
     local stores = debris and debris:FindFirstChild("Stores") or nil
     if not stores then return end

     local closestPrompt = nil
     local closestScreenDist = math.huge

     for i = 1, 24 do
         if not autoOplataEnabled then break end

         local storeModel = stores:FindFirstChild("Store_" .. tostring(i))
         if storeModel then
             local boundingBox = storeModel:FindFirstChild("BoundingBox")
             local purchaseAttachment = boundingBox and boundingBox:FindFirstChild("PurchasePrompt", true) or nil
             if purchaseAttachment and not purchaseAttachment:IsA("Attachment") then
                 purchaseAttachment = nil
             end
             local prompt = purchaseAttachment and purchaseAttachment:FindFirstChildOfClass("ProximityPrompt") or nil

             if prompt and prompt.Enabled then
                 local pos3 = purchaseAttachment and purchaseAttachment.WorldPosition or nil
                 if not pos3 then
                     continue
                 end

                 local distOk = true
                 if prompt.MaxActivationDistance and humanRootPart then
                     local dist = (humanRootPart.Position - pos3).Magnitude
                     if dist > prompt.MaxActivationDistance then
                         distOk = false
                     end
                 end
                 if not distOk then
                     continue
                 end

                 if pos3 then
                     local screenPos, onScreen = camera:WorldToViewportPoint(pos3)
                     if onScreen and screenPos.Z > 0 then
                         local viewportSize = camera.ViewportSize
                         local center = Vector2.new(viewportSize.X / 2, viewportSize.Y / 2)
                         local pos2d = Vector2.new(screenPos.X, screenPos.Y)
                         local screenDist = (pos2d - center).Magnitude

                         if screenDist < closestScreenDist then
                             closestScreenDist = screenDist
                             closestPrompt = prompt
                         end
                     end
                 end
             end
         end
     end

     if closestPrompt then
         pcall(function()
             if fireproximityprompt then
                 fireproximityprompt(closestPrompt)
             else
                 closestPrompt:InputHoldBegin()
                 task.wait(closestPrompt.HoldDuration + 0.1)
                 closestPrompt:InputHoldEnd()
             end
         end)
     end
 end

function UpdateAutoBuy()
    if not autoBuyEnabled then return end
        local character = lp.Character
    local humanRootPart = character and character:FindFirstChild("HumanoidRootPart")
        local rubleStat = lp:FindFirstChild("leaderstats") and lp.leaderstats:FindFirstChild("Рубли")
    if not (humanRootPart and rubleStat) then return end
    local camera = workspace.CurrentCamera
    local playerCash = rubleStat.Value
    local closestPromptData = {prompt = nil, screenDist = math.huge}
    local worldFolder = game.Workspace:FindFirstChild("World")
    if not worldFolder then return end
    for _, storeItemModel in ipairs(worldFolder:GetDescendants()) do
        if storeItemModel:IsA("Model") and storeItemModel:FindFirstChild("Clothing") then
            local clothingPart = storeItemModel.Clothing
            local prompt = storeItemModel:FindFirstChildOfClass("ProximityPrompt")

            if prompt and prompt.Enabled and prompt.ActionText ~= "Повесить" then
                -- учитывать только промпты, которые реально находятся в поле зрения камеры (впереди камеры и в кадре)
                local screenPos, onScreen
                local screenDist = math.huge
                if camera then
                    screenPos, onScreen = camera:WorldToViewportPoint(clothingPart.Position)
                    if (not onScreen) or screenPos.Z <= 0 then
                        continue
                    end
                    local viewportSize = camera.ViewportSize
                    local center = Vector2.new(viewportSize.X / 2, viewportSize.Y / 2)
                    local pos2d = Vector2.new(screenPos.X, screenPos.Y)
                    screenDist = (pos2d - center).Magnitude
                end

                local distance = (humanRootPart.Position - clothingPart.Position).Magnitude
                if distance <= prompt.MaxActivationDistance then
                    local clothName = prompt.ObjectText
                    local currentPriceText = string.gsub(prompt.ActionText, "%D+", "")
                    local currentPrice = nil
                    if currentPriceText and currentPriceText ~= "" then
                        currentPrice = tonumber(currentPriceText)
                    end

                    local cashOk = true
                    if currentPrice ~= nil then
                        cashOk = (playerCash >= currentPrice)
                    end

                    local isGoodDeal = true
                    if autoBuyOnlyPayOff then
                        isGoodDeal = false
                        if currentPrice ~= nil then
                            local payOff = masterPriceTable[clothName]
                            if payOff and currentPrice <= payOff then
                                isGoodDeal = true
                            end
                            if not isGoodDeal then
                                for _, rule in ipairs(generalBrandRules) do
                                    if string.find(string.lower(clothName), string.lower(rule.keyword), 1, true) then
                                        if rule.alwaysPick or (currentPrice <= rule.maxPrice) then
                                            isGoodDeal = true
                                            break
                                        end
                                    end
                                end
                            end
                        end
                    end

                    if isGoodDeal and cashOk then
                        if screenDist < closestPromptData.screenDist then
                            closestPromptData.screenDist = screenDist
                            closestPromptData.prompt = prompt
                        end
                    end
                end
            end
        end
    end
    local closestPrompt = closestPromptData.prompt
    if closestPrompt and closestPrompt.Parent then
            Library:Notify({Title = "Авто взятие", Description = "Беру: " .. tostring(closestPrompt.ObjectText), Time = 2})
            local success, err = pcall(function()
                closestPrompt:InputHoldBegin()
                task.wait(closestPrompt.HoldDuration + 0.1)
                closestPrompt:InputHoldEnd()
            end)
            if not success then
                Library:Notify({Title = "Авто взятие", Description = "Ошибка: " .. tostring(err), Time = 5})
            end
        task.wait(0.5)
    end
end

    AutoBuyGroup:AddLabel("Метод", "Используется Input Simulation (удержание ProximityPrompt).")

    AutoBuyGroup:AddSlider("AutoBuyDelay", {
        Text = "Задержка (сек)",
        Tooltip = "Задержка между попытками покупки. Увеличьте, если игра ругается на частые действия.",
        Min = 0.2,
        Max = 5,
        Default = autoBuyDelay,
        Rounding = 1,
        Callback = function(v)
            autoBuyDelay = v
        end
    })

    AutoBuyGroup:AddToggle("EnableAutoBuy", {
        Text = "Авто взятие",
        Tooltip = "Автоматически берёт вещи с магазинов, которые находятся рядом с вами.",
        Default = autoBuyEnabled,
    Callback = function(Value)
        autoBuyEnabled = Value
        if autoBuyEnabled then
                Library:Notify({Title = "Авто взятие", Description = "Включено", Time = 2})
            if not autoBuyLoopActive then
                autoBuyLoopActive = true
                task.spawn(function()
                    while autoBuyEnabled and autoBuyLoopActive do
                        UpdateAutoBuy()
                        task.wait(autoBuyDelay)
                    end
                    autoBuyLoopActive = false
                end)
            end
        else
                Library:Notify({Title = "Авто взятие", Description = "Выключено", Time = 2})
            autoBuyLoopActive = false
        end
    end
})

    AutoBuyGroup:AddCheckbox("AutoBuyOnlyPayOff", {
        Text = "Только окупная",
        Default = autoBuyOnlyPayOff,
    })
    Toggles.AutoBuyOnlyPayOff:OnChanged(function(state)
        autoBuyOnlyPayOff = state
    end)

    AutoBuyGroup:AddToggle("EnableAutoOplata", {
        Text = "Авто оплата",
        Tooltip = "Автоматически нажимает ближайшую видимую кнопку 'Оплатить' в магазинах (Stores).",
        Default = autoOplataEnabled,
        Callback = function(v)
            autoOplataEnabled = v
            if autoOplataEnabled then
                if not autoOplataLoopActive then
                    autoOplataLoopActive = true
                    task.spawn(function()
                        while autoOplataEnabled and autoOplataLoopActive do
                            UpdateAutoOplata()
                            task.wait(0.25)
                        end
                        autoOplataLoopActive = false
                    end)
                end
            else
                autoOplataLoopActive = false
            end
        end
    })

     local unlimitedClothesEnabled = false
     local backpackConn
     local pendingBring = false

     local function BringAllToolsToCharacter()
         local character = lp.Character
         local backpack = lp:FindFirstChildOfClass("Backpack")
         if not (character and backpack) then return end

         -- Важно: не используем Humanoid:EquipTool(), чтобы не переключать предметы по одному.
         for _, tool in ipairs(backpack:GetChildren()) do
             if tool:IsA("Tool") then
                 pcall(function()
                     tool.Parent = character
                 end)
             end
         end
     end

     AutoBuyGroup:AddCheckbox("UnlimitedClothes", {
         Text = "Убрать ограничение одежд",
         Tooltip = "Переносит все вещи (Tool) из Backpack в персонажа без постоянного переключения в руках. Реагирует на новые вещи.",
         Default = false,
     })

     Toggles.UnlimitedClothes:OnChanged(function(state)
         unlimitedClothesEnabled = state

         if backpackConn then
             backpackConn:Disconnect()
             backpackConn = nil
         end

         if unlimitedClothesEnabled then
             local backpack = lp:FindFirstChildOfClass("Backpack")
             if backpack then
                 backpackConn = backpack.ChildAdded:Connect(function(child)
                     if not (unlimitedClothesEnabled and child and child:IsA("Tool")) then return end
                     if pendingBring then return end
                     pendingBring = true
                     task.defer(function()
                         task.wait(0.08)
                         pendingBring = false
                         if unlimitedClothesEnabled then
                             BringAllToolsToCharacter()
                         end
                     end)
                 end)
             end

             BringAllToolsToCharacter()
         else
             pendingBring = false
         end
     end)


--#endregion AutoBuy Tab

--#region AutoSell Tab
do
    local AutoSellGroup = Tabs.AutoSell:AddLeftGroupbox("Инвентарь")
    local autoSellDelay = 0.5 -- задержка между продажами, чтобы не ловить анти-ддос
    local dropdownMap = {} -- Maps unique dropdown names to item hashes
    local selectedHashesToSell = {}

    local itemsDropdown = AutoSellGroup:AddDropdown("ItemsToSell", {
        Text = "Выбрать вещи для продажи",
        Tooltip = "Выберите конкретные вещи из инвентаря, которые нужно продать.",
        Values = {},
        Multi = true,
        Callback = function(selected)
            selectedHashesToSell = {} -- Clear previous selections
            for uniqueName, isSelected in pairs(selected) do
                if isSelected and dropdownMap[uniqueName] then
                    table.insert(selectedHashesToSell, dropdownMap[uniqueName])
                end
            end
        end
    })

    local function populateInventoryDropdown()
        if not getPlayerData then return end
        
        dropdownMap = {}
        local dropdownValues = {}
        local itemNameCounts = {}
        
        Library:Notify({Title = "Инвентарь", Description = "Загрузка вещей...", Time = 2})

        local success, playerData = pcall(function() return getPlayerData:InvokeServer() end)
        if not success then
            Library:Notify({Title = "Ошибка", Description = "Не удалось получить данные инвентаря.", Time = 5})
            return
        end

        if playerData and playerData.Inventory then
            for _, itemData in ipairs(playerData.Inventory) do
                local itemName = itemData.ItemName or "Неизвестный предмет"
                local itemHash = itemData.ItemHash
                if itemHash then
                    itemNameCounts[itemName] = (itemNameCounts[itemName] or 0) + 1
                    local uniqueName = string.format("%s (#%d)", itemName, itemNameCounts[itemName])
                    
                    dropdownMap[uniqueName] = itemHash
                    table.insert(dropdownValues, uniqueName)
                end
            end
        end
        
        table.sort(dropdownValues)
        itemsDropdown:SetValues(dropdownValues)
        Library:Notify({Title = "Инвентарь", Description = "Список вещей обновлен.", Time = 2})
    end

    AutoSellGroup:AddButton({
        Text = "Продать выбранное",
        Tooltip = "Продать только те вещи, которые вы выбрали в списке выше.",
        Func = function()
            task.spawn(function()
                if not sellClothing then return end
                if not selectedHashesToSell or #selectedHashesToSell == 0 then
                    Library:Notify({Title = "Внимание", Description = "Вы не выбрали ни одного предмета для продажи.", Time = 4})
                    return
                end

                Library:Notify({Title = "Продажа", Description = "Продаю " .. #selectedHashesToSell .. " выбранных предметов...", Time = 3})
                local soldCount = 0
                for _, hash in ipairs(selectedHashesToSell) do
                    pcall(function() sellClothing:InvokeServer(hash) end)
                    soldCount = soldCount + 1
                    task.wait(autoSellDelay)
                end
                Library:Notify({Title = "Готово", Description = "Успешно продано " .. soldCount .. " предметов.", Time = 4})
                
                task.wait(1)
                populateInventoryDropdown()
            end)
        end
    })

    AutoSellGroup:AddDivider()

    AutoSellGroup:AddSlider("AutoSellDelay", {
        Text = "Задержка продажи (сек)",
        Tooltip = "Задержка между продажами вещей, помогает не поймать анти-ддос.",
        Min = 0,
        Max = 2,
        Default = autoSellDelay,
        Rounding = 2,
        Callback = function(v)
            autoSellDelay = v
        end
    })

    AutoSellGroup:AddButton({
        Text = "Продать весь инвентарь",
        Tooltip = "ВНИМАНИЕ: Продает абсолютно все вещи. Действие необратимо.",
        DoubleClick = true,
        Risky = true,
        Func = function()
            task.spawn(function()
                if not getPlayerData or not sellClothing then return end
                local itemsSoldTotal = 0
                Library:Notify({Title = "Продажа", Description = "Начинаю продажу всего инвентаря...", Time = 2})
                local success, playerData = pcall(function() return getPlayerData:InvokeServer() end)
                if not success then
                    Library:Notify({Title = "❌ Ошибка", Description = "Не удалось получить данные инвентаря для продажи.", Time = 5})
                    return
                end
                if playerData and playerData.Inventory then
                    for _, itemData in ipairs(playerData.Inventory) do
                        if itemData.ItemHash then
                            pcall(function() sellClothing:InvokeServer(itemData.ItemHash) end)
                            itemsSoldTotal = itemsSoldTotal + 1
                            task.wait(autoSellDelay)
                        end
                    end
                end
                Library:Notify({Title = "Готово", Description = "Продано " .. itemsSoldTotal .. " предметов.", Time = 4})
            end)
        end
    })

     local lastInventorySig = ""
     local lastAutoRefreshAt = 0

     task.spawn(function()
         while Library and not Library.Unloaded do
             task.wait(6)
             if not getPlayerData then continue end

             if tick() - lastAutoRefreshAt < 6 then
                 continue
             end

             local ok, playerData = pcall(function() return getPlayerData:InvokeServer() end)
             if not ok or not playerData or not playerData.Inventory then
                 continue
             end

             local sigParts = {}
             for i = 1, math.min(#playerData.Inventory, 80) do
                 local it = playerData.Inventory[i]
                 sigParts[#sigParts + 1] = tostring(it.ItemHash or "")
             end
             local sig = tostring(#playerData.Inventory) .. ":" .. table.concat(sigParts, ",")

             if sig ~= lastInventorySig then
                 lastInventorySig = sig
                 lastAutoRefreshAt = tick()
                 populateInventoryDropdown()
             end
         end
     end)
end
--#endregion AutoSell Tab

--#region Skin Changer Tab
do
    local SkinGroup = Tabs.SkinChanger:AddLeftGroupbox("Скинчейнджер")

    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local selectedShirtName
    local selectedPantsName
    local shirtMap = {}
    local pantsMap = {}

    local function getClothingRoot()
        local content = ReplicatedStorage:FindFirstChild("Content")
        local clothing = content and content:FindFirstChild("Clothing")
        return clothing
    end

    local function getTemplateFromItem(item, kind)
        if not item then return nil end
        if kind == "Shirt" then
            if item:IsA("Shirt") then
                return item.ShirtTemplate
            end
            local v = item:FindFirstChild("ShirtTemplate")
            if v and v:IsA("StringValue") then return v.Value end
        elseif kind == "Pants" then
            if item:IsA("Pants") then
                return item.PantsTemplate
            end
            local v = item:FindFirstChild("PantsTemplate")
            if v and v:IsA("StringValue") then return v.Value end
        end
        if typeof(item) == "Instance" then
            local name = tostring(item.Name or "")
            if name:find("rbxassetid://", 1, true) then
                return name
            end
        end
        return nil
    end

    local function ensureClothing(character, className)
        if not character then return nil end
        local existing = character:FindFirstChildOfClass(className)
        if existing then return existing end
        local inst = Instance.new(className)
        inst.Parent = character
        return inst
    end

    local function applyTemplate(kind, template)
        if not template or template == "" then
            Library:Notify({ Title = "Скинчейнджер", Description = "Шаблон не найден", Time = 3 })
            return
        end
        local lp = game:GetService("Players").LocalPlayer
        local character = lp and lp.Character
        if not character then
            Library:Notify({ Title = "Скинчейнджер", Description = "Персонаж не найден", Time = 3 })
            return
        end
        if kind == "Shirt" then
            local shirt = ensureClothing(character, "Shirt")
            if shirt then
                pcall(function() shirt.ShirtTemplate = template end)
                Library:Notify({ Title = "Скинчейнджер", Description = "Футболка применена", Time = 2 })
            end
        elseif kind == "Pants" then
            local pants = ensureClothing(character, "Pants")
            if pants then
                pcall(function() pants.PantsTemplate = template end)
                Library:Notify({ Title = "Скинчейнджер", Description = "Штаны применены", Time = 2 })
            end
        end
    end

    local shirtDropdown = SkinGroup:AddDropdown("SkinChangerShirt", {
        Text = "Футболка",
        Tooltip = "Выбор футболки.",
        Values = {},
        Multi = false,
        Callback = function(v)
            selectedShirtName = v
        end
    })

    SkinGroup:AddButton({
        Text = "Применить футболку",
        Tooltip = "Применяет выбранную футболку.",
        Func = function()
            local t = selectedShirtName and shirtMap[selectedShirtName]
            applyTemplate("Shirt", t)
        end
    })

    local pantsDropdown = SkinGroup:AddDropdown("SkinChangerPants", {
        Text = "Штаны",
        Tooltip = "Выбор штанов.",
        Values = {},
        Multi = false,
        Callback = function(v)
            selectedPantsName = v
        end
    })

    SkinGroup:AddButton({
        Text = "Применить штаны",
        Tooltip = "Применяет выбранные штаны.",
        Func = function()
            local t = selectedPantsName and pantsMap[selectedPantsName]
            applyTemplate("Pants", t)
        end
    })

    local function refreshLists()
        shirtMap = {}
        pantsMap = {}
        local shirtValues = {}
        local pantsValues = {}

        local clothing = getClothingRoot()
        local shirtFolder = clothing and clothing:FindFirstChild("Shirt")
        local pantsFolder = clothing and clothing:FindFirstChild("Pants")

        if shirtFolder then
            for _, item in ipairs(shirtFolder:GetChildren()) do
                local template = getTemplateFromItem(item, "Shirt")
                if template and template ~= "" then
                    local name = tostring(item.Name)
                    shirtMap[name] = template
                    table.insert(shirtValues, name)
                end
            end
        end

        if pantsFolder then
            for _, item in ipairs(pantsFolder:GetChildren()) do
                local template = getTemplateFromItem(item, "Pants")
                if template and template ~= "" then
                    local name = tostring(item.Name)
                    pantsMap[name] = template
                    table.insert(pantsValues, name)
                end
            end
        end

        table.sort(shirtValues)
        table.sort(pantsValues)

        if shirtDropdown and shirtDropdown.SetValues then
            shirtDropdown:SetValues(shirtValues)
        end
        if pantsDropdown and pantsDropdown.SetValues then
            pantsDropdown:SetValues(pantsValues)
        end
    end

    SkinGroup:AddButton({
        Text = "Обновить список",
        Tooltip = "Обновляет список одежды.",
        Func = function()
            refreshLists()
            Library:Notify({ Title = "Скинчейнджер", Description = "Список обновлен", Time = 2 })
        end
    })

    refreshLists()
end
--#endregion Skin Changer Tab


--#region Brands Info Tab
do
    local BrandsGuideGroup = Tabs.BrandsInfo:AddLeftGroupbox("Рекомендации по брендам")
    
    local guideGui, frame, scrollingFrame
    local TweenService = game:GetService("TweenService")
    local UserInputService = game:GetService("UserInputService")

    local function createGuideGui()
        guideGui = Instance.new("ScreenGui")
        guideGui.Name = "BrandsGuideGui"
        guideGui.ResetOnSpawn = false
        guideGui.Enabled = false

        frame = Instance.new("Frame", guideGui)
        frame.Name = "MainFrame"
        frame.Size = UDim2.new(0, 340, 0, 480)
        frame.AnchorPoint = Vector2.new(0.5, 0.5)
        frame.Position = UDim2.new(0.5, 0, 0.5, 0)
        frame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
        frame.BorderSizePixel = 0

        local corner = Instance.new("UICorner", frame)
        corner.CornerRadius = UDim.new(0, 8)

        local stroke = Instance.new("UIStroke", frame)
        stroke.Color = Color3.fromRGB(70, 70, 70)
        stroke.Thickness = 1

        local titleLabel = Instance.new("TextLabel", frame)
        titleLabel.Name = "Title"
        titleLabel.Size = UDim2.new(1, 0, 0, 40)
        titleLabel.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
        titleLabel.Text = "Гайд брендов"
        titleLabel.Font = Enum.Font.SourceSansBold
        titleLabel.TextSize = 18
        titleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
        local titleCorner = Instance.new("UICorner", titleLabel)
        titleCorner.CornerRadius = UDim.new(0, 8)

        local closeButton = Instance.new("TextButton", titleLabel)
        closeButton.Name = "CloseButton"
        closeButton.Size = UDim2.new(0, 30, 0, 30)
        closeButton.Position = UDim2.new(1, -35, 0.5, -15)
        closeButton.Text = "X"
        closeButton.Font = Enum.Font.SourceSansBold
        closeButton.TextSize = 16
        closeButton.TextColor3 = Color3.fromRGB(200, 200, 200)
        closeButton.BackgroundTransparency = 1
        closeButton.ZIndex = 2
        
        local subtitle = Instance.new("TextLabel", frame)
        subtitle.Name = "Subtitle"
        subtitle.Size = UDim2.new(1, -20, 0, 24)
        subtitle.Position = UDim2.new(0, 10, 0, 40)
        subtitle.BackgroundTransparency = 1
        subtitle.Font = Enum.Font.SourceSans
        subtitle.TextSize = 14
        subtitle.TextColor3 = Color3.fromRGB(190, 190, 190)
        subtitle.TextXAlignment = Enum.TextXAlignment.Left
        subtitle.TextWrapped = true
        subtitle.Text = "Гайд и описание каждого бренда."

        scrollingFrame = Instance.new("ScrollingFrame", frame)
        scrollingFrame.Size = UDim2.new(1, 0, 1, -64)
        scrollingFrame.Position = UDim2.new(0, 0, 0, 64)
        scrollingFrame.BackgroundTransparency = 1
        scrollingFrame.BorderSizePixel = 0
        scrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 80)
        scrollingFrame.ScrollBarThickness = 6
        scrollingFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y

        local listLayout = Instance.new("UIListLayout", scrollingFrame)
        listLayout.Padding = UDim.new(0, 10)
        listLayout.SortOrder = Enum.SortOrder.LayoutOrder
        listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

        local contentPadding = Instance.new("UIPadding", scrollingFrame)
        contentPadding.PaddingLeft = UDim.new(0, 10)
        contentPadding.PaddingRight = UDim.new(0, 10)
        contentPadding.PaddingTop = UDim.new(0, 10)

        local brandData = {
            {"Смешные цены", "магазин для всех для старта следуя по ESP (средняя окупаемость 50-100 руб)"},
            {"Спорт Мастер", "магазин для продолжения по ESP,с ним вы будете уже иметь минимум 10к если будете покупать у esp все. (средняя окупаемость 3-5к зависит от одежды)"},
            {"Зара", "неплохой впринципе магазин если нет других,чуть окупает (средняя окупаемость 5-10к)"},
            {"Баленсиага", "неплохой магазин но в последнее время может вас не окупить,будьте аккуратны следуя по esp."},
            {"Бейп", "отличный магазин который в основном хорошо окупает в среднем на 10-30к"},
            {"Стоник", "магазин который может вас окупить на 20к,так и может вам слить 20к"},
            {"Монклер", "лучший магазин для окупаемости,покупайте все штаны,остальную часть следуйте по esp строго ели хотите взять верхнюю одежду,не обязательно быть богатым чтобы пойти туда,вы можете использовать продажу инвентаря после покупки сразу (средняя окупаемость 50к)"},
            {"Тнф", "магазин не очень по моему мнению,слабая окупаемость и высокий риск слить денег."},
            {"Адидас", "средний магаз впринципе сейчас уже лучше стал (средняя окупаемость 1-10к)"},
            {"Найк", "нету окупаемости,забудьте про этот магаз."},
            {"Ефремов", "Магаз который имеет пали (средняя окупа 1-20к) тоже можно на нем слить."},
            {"Сп компани", "магазин который уже мало имеет окупа,спорт мастер даже больше может окупить."},
            {"Луи Виттон", "редко вижу окупаемость,норм может быть только для перепродажи другим игрокам"},
            {"Рик Овенс", "не заю магаз,не окупал ни разу и не показывал окупаемость."},
            {"Гуччи", "часто может иметь окупаемость (средняя окупаемость 1-25к)"},
            {"Суприм", "магазин норм редко выдает слив (Средняя окупаемость 10к)"},
            {"Хром", "имба магазин но минимум иметь нужно 100к (средняя окупаемость 10-150к)"}
        }

        for _, data in ipairs(brandData) do
            local card = Instance.new("Frame")
            card.Parent = scrollingFrame
            card.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
            card.BackgroundTransparency = 0
            card.BorderSizePixel = 0
            card.Size = UDim2.new(1, 0, 0, 0)
            card.AutomaticSize = Enum.AutomaticSize.Y

            local cardLayout = Instance.new("UIListLayout", card)
            cardLayout.Padding = UDim.new(0, 6)
            cardLayout.SortOrder = Enum.SortOrder.LayoutOrder
            cardLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left

            local cardCorner = Instance.new("UICorner", card)
            cardCorner.CornerRadius = UDim.new(0, 6)

            local cardStroke = Instance.new("UIStroke", card)
            cardStroke.Color = Color3.fromRGB(70, 70, 70)
            cardStroke.Thickness = 1

            local pad = Instance.new("UIPadding", card)
            pad.PaddingLeft = UDim.new(0, 10)
            pad.PaddingRight = UDim.new(0, 10)
            pad.PaddingTop = UDim.new(0, 8)
            pad.PaddingBottom = UDim.new(0, 8)

            local title = Instance.new("TextLabel")
            title.Parent = card
            title.LayoutOrder = 1
            title.BackgroundTransparency = 1
            title.Size = UDim2.new(1, 0, 0, 0)
            title.AutomaticSize = Enum.AutomaticSize.Y
            title.RichText = true
            title.Font = Enum.Font.SourceSansBold
            title.TextSize = 16
            title.TextColor3 = Color3.fromRGB(230, 230, 230)
            title.TextXAlignment = Enum.TextXAlignment.Left
            title.TextWrapped = true
            title.Text = string.format("<font size='16'>%s</font>", tostring(data[1] or ""))

            local desc = Instance.new("TextLabel")
            desc.Parent = card
            desc.LayoutOrder = 2
            desc.BackgroundTransparency = 1
            desc.Size = UDim2.new(1, 0, 0, 0)
            desc.AutomaticSize = Enum.AutomaticSize.Y
            desc.RichText = true
            desc.Font = Enum.Font.SourceSans
            desc.TextSize = 15
            desc.TextColor3 = Color3.fromRGB(190, 190, 190)
            desc.TextXAlignment = Enum.TextXAlignment.Left
            desc.TextWrapped = true
            desc.Text = tostring(data[2] or "")
        end

        -- Draggable functionality (возможность двигать за любой участок окна)
        local dragging = false
        local dragStart
        local startPos

        local function beginDrag(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true
                dragStart = input.Position
                startPos = frame.Position
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end

        titleLabel.InputBegan:Connect(beginDrag)
        frame.InputBegan:Connect(beginDrag)

        UserInputService.InputChanged:Connect(function(input)
            if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)

        local function animate(open)
            if open then
                guideGui.Enabled = true
                frame.Size = UDim2.new(0, 340, 0, 0)
                TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 340, 0, 480)}):Play()
            else
                local tween = TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0, 340, 0, 0)})
                tween.Completed:Connect(function() guideGui.Enabled = false end)
                tween:Play()
            end
        end
        
        closeButton.MouseButton1Click:Connect(function() animate(false) end)
        
        BrandsGuideGroup:AddButton({
            Text = "Открыть гайд брендов",
            Tooltip = "Открыть подробное руководство по брендам в отдельном окне.",
            Func = function()
                animate(true)
            end
        })

        guideGui.Parent = game:GetService("CoreGui")
        Library:OnUnload(function() if guideGui then guideGui:Destroy() end end)
    end
    
    createGuideGui()
end
--#endregion Brands Info Tab

--#region Webhook Tab
do
local webhookSettingsFile = "CasualStock_WebhookSettings.json"
local webhookSettings = {
    url = "",
    autoSend = false,
    sendStealedClothes = false,
    sendVerifiedPlayers = false,
    sendCashProgressPerStock = false
}

local function saveWebhookSettings()
    pcall(function()
        writefile(webhookSettingsFile, HttpService:JSONEncode(webhookSettings))
    end)
end

local function loadWebhookSettings()
    if isfile and isfile(webhookSettingsFile) then
        local ok, data = pcall(readfile, webhookSettingsFile)
        if ok and data and data ~= "" then
            local ok2, tbl = pcall(function() return HttpService:JSONDecode(data) end)
            if ok2 and tbl then webhookSettings = tbl end
        end
    end
end
loadWebhookSettings()

local function sendWebhook(data)
        if not webhookSettings or not webhookSettings.url or webhookSettings.url == "" then return end
    local jsonData = HttpService:JSONEncode(data)
    local headers = { ["Content-Type"] = "application/json" }
        pcall(function()
        local request_func = http_request or request or HttpPost or syn.request
        if request_func then
            request_func({Url = webhookSettings.url, Body = jsonData, Method = "POST", Headers = headers})
        else
            game:HttpPost(webhookSettings.url, jsonData, false, "application/json")
        end
    end)
end

    local WebhookGroup = Tabs.Webhook:AddLeftGroupbox("Интеграция Discord")
    WebhookGroup:AddInput("WebhookURL", {
        Text = "Discord Webhook URL",
        Tooltip = "Введите ссылку на ваш Discord вебхук.",
    Placeholder = "https://discord.com/api/webhooks/...",
        Default = webhookSettings.url,
        Finished = true,
    Callback = function(text)
        webhookSettings.url = text
        saveWebhookSettings()
            		Library:Notify({ Title = "Webhook", Description = "Ссылка сохранена", Time = 2 })
	end
})
    WebhookGroup:AddCheckbox("AutoSendWebhook", {
        Text = "Авто-отправка вебхука",
        Tooltip = "Автоматически отправлять базовые уведомления о действиях.",
        Default = webhookSettings.autoSend,
        Callback = function(val)
            webhookSettings.autoSend = val
            saveWebhookSettings()
            Library:Notify({ Title = "Webhook", Description = val and "Авто-отправка включена" or "Авто-отправка выключена", Time = 2 })
        end
    })

    WebhookGroup:AddCheckbox("SendStealedClothes", {
        Text = "Отправлять украденную одежду",
        Tooltip = "Отправлять в Discord информацию о украденной одежде.",
        Default = webhookSettings.sendStealedClothes,
        Callback = function(val)
            webhookSettings.sendStealedClothes = val
            saveWebhookSettings()
        end
    })

    WebhookGroup:AddCheckbox("SendVerifiedPlayers", {
        Text = "Отправлять проверенных игроков",
        Tooltip = "Отправлять список найденных проверенных игроков на сервере.",
        Default = webhookSettings.sendVerifiedPlayers,
        Callback = function(val)
            webhookSettings.sendVerifiedPlayers = val
            saveWebhookSettings()
        end
    })

    WebhookGroup:AddCheckbox("SendCashProgressPerStock", {
        Text = "Отправлять доход за сток",
        Tooltip = "Отправлять, сколько денег было заработано/потеряно за один сток (в конце стока).",
        Default = webhookSettings.sendCashProgressPerStock,
        Callback = function(val)
            webhookSettings.sendCashProgressPerStock = val
            saveWebhookSettings()
        end
    })
end
--#endregion Webhook Tab

--#region UI Settings Tab
do
    ThemeManager:SetLibrary(Library)
    SaveManager:SetLibrary(Library)

    SaveManager:IgnoreThemeSettings()
    SaveManager:SetIgnoreIndexes({ "MenuKeybind", "WebhookURL", "AutoSendWebhook" })

    ThemeManager:SetFolder("CasualStock")
    SaveManager:SetFolder("CasualStock/configs")

    SaveManager:BuildConfigSection(Tabs.UISettings)
    ThemeManager:ApplyToTab(Tabs.UISettings)
    
    local MenuGroup = Tabs.UISettings:AddLeftGroupbox("Menu")
    
    MenuGroup:AddLabel("Menu bind")
	    :AddKeyPicker("MenuKeybind", { Default = "RightControl", NoUI = true, Text = "Menu keybind" })
        
    Library.ToggleKeybind = Options.MenuKeybind
    
    MenuGroup:AddButton({
        Text = "Unload",
        Func = function()
	        Library:Unload()
        end,
        Risky = true
    })
    
    Library:OnUnload(function()
        print("Casual Stock Unloaded!")
    end)

    SaveManager:LoadAutoloadConfig()
end
--#endregion UI Settings Tab

local function findItemsToHighlight()
    local items = {}

    local world = workspace:FindFirstChild("World")
    if not world then return items end

    local debris = world:FindFirstChild("Debris")
    if not debris then return items end

    local storesFolder = debris:FindFirstChild("Stores")
    if not storesFolder then return items end

    for _, store in ipairs(storesFolder:GetChildren()) do
        if store:IsA("Model") then
            local placementContainer = store:FindFirstChild("PlacementContainer")
            if placementContainer then
                for _, container in ipairs(placementContainer:GetChildren()) do
                    if container:IsA("Model") then
                        -- скипаем пустые контейнеры без дочерних объектов
                        if #container:GetChildren() > 0 then
                            local itemContainer = container:FindFirstChild("ItemContainer")
                            if itemContainer then
                                for _, model in ipairs(itemContainer:GetChildren()) do
                                    if model:IsA("Model") then
                                        table.insert(items, model)
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end

    return items
end

function UpdateESPPayOffClothes()
    if not espPayOffClothesEnabled or not lp or not lp.Character then return end
    local hrp = lp.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local seenThisUpdate = {}

    for _, model in ipairs(findItemsToHighlight()) do
        local clothingPart = model:FindFirstChild("Clothing")
        if clothingPart and clothingPart:IsA("BasePart") then
            local dist = (clothingPart.Position - hrp.Position).Magnitude
            if dist <= espMaxDistance then
                				local clothName = clothingPart.Name or "Неизвестный предмет"
				local priceLabel = model:FindFirstChild("Price")
				local currentPriceText = (priceLabel and priceLabel:IsA("TextLabel") and priceLabel.Text) or "Цена неизвестна"
			local currentPrice = tonumber(currentPriceText:gsub("%D+", ""))

            if currentPrice then
                local itemShouldHaveESP = false
                local richEspText = ""

                local nearThreshold, warnText = false, nil
                if masterPriceTable[clothName] then
                    local payOffPrice = masterPriceTable[clothName]
                    if currentPrice and payOffPrice and currentPrice <= payOffPrice then
                        itemShouldHaveESP = true
                        -- скрываем цены/пороги, только название
                        richEspText = string.format('<font face="SourceSansSemibold" size="18" color="rgb(255,255,255)">%s</font>', clothName)
                        nearThreshold, warnText = false, nil
                    end
                end

                if not itemShouldHaveESP then
                    for _, rule in ipairs(generalBrandRules) do
                        if string.find(string.lower(clothName), string.lower(rule.keyword), 1, true) then
                            if rule.alwaysPick or (currentPrice and currentPrice <= rule.maxPrice) then
                                itemShouldHaveESP = true
                                -- скрываем цены/пороги, только название
                                richEspText = string.format('<font face="SourceSansSemibold" size="18" color="rgb(255,255,255)">%s</font>', clothName)
                                break 
                            end
                        end
                    end
                end
            end
                -- фильтр по брендам: если у вещи есть бренд и он отключён в фильтре, не подсвечиваем
                local brand = itemBrandIndex[clothName] or normalizedBrandIndex[normalizeName(clothName)]
                if brand and espBrandFilter[brand] == false then
                    itemShouldHaveESP = false
                end

                -- фильтр по балансу
                if espBalanceFilterEnabled and currentPrice then
                    local balance = getPlayerBalance()
                    if currentPrice > balance then
                        itemShouldHaveESP = false
                    end
                end

                if itemShouldHaveESP then
                    seenThisUpdate[model] = true
                   local cachedESP = activeESPCache[model]

                       if not cachedESP then
                           cachedESP = GetOrCreateESPElements(clothingPart)
                           activeESPCache[model] = cachedESP
                       end
                       -- apply near-threshold flags for this cycle
                       cachedESP.nearThreshold = nearThreshold or false
                       cachedESP.warnText = warnText
                       
                       -- Apply style only when content/style changed
                       if cachedESP.lastText ~= richEspText or cachedESP.lastStyle ~= espStyle then
                           ApplyESPStyle(cachedESP, espStyle, richEspText)
                           cachedESP.lastText = richEspText
                           cachedESP.lastStyle = espStyle
                       end
                end
            end
        end
    end
    
    for model, espData in pairs(activeESPCache) do
        if not seenThisUpdate[model] or not model.Parent then
            ReturnESPElementsToPool(espData)
            activeESPCache[model] = nil
        end
    end
end